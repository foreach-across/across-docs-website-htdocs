<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Across - Across</title>
    <meta name="generator" content="Antora 1.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
<meta name="og:title" content="Across Documentation"/>
<meta name="og:image" content="https://across.foreach.be/across/resources/static/acrossWebsite/img/og-image-across.jpg"/>
<link rel="icon" type="image/png" sizes="16x16" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-16x16.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="96x96" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-96x96.png"/>
<link rel="apple-touch-icon" type="image/png" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-120x120.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-152x152.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-180x180.png"/>
  </head>
  <body class="article">
<header class="header" role="banner">
  <div class="m-mobile-menu__button js-overlay-menu-button" data-target="mobile-menu">
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
  </div>
  <div class="m-mobile-menu">
    <div class="m-mobile-menu__logo">
      <a class="m-nav__logo" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
          <title>logo-across</title>
          <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
          <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
          <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
          <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
          <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
          <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
        </svg>
        <span>Across</span>
      </a>
    </div>
  </div>
  <div class="m-mobile-menu__container js-mobile-menu-overlay" id="mobile-menu">
    <nav class="m-mobile-menu__list">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </nav>
  </div>
  <nav class="m-nav is-sticky">
    <a class="m-nav__logo" href="../../..">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
        <title>logo-across</title>
        <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
        <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
        <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
        <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
        <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
        <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
      </svg>
      <span>Across</span>
    </a>

    <div class="m-nav__link-group">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="across" data-version="3.0.0">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Across</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chap-in-a-nutshell.html">Across in a Nutshell</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts.html">Fundamental concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../releases/index.html">Releases</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../releases/release-notes.html">Release notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../releases/releases-3.x.html">3.x</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../releases/releases-2.x.html">2.x</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../releases/releases-1.x.html">1.x</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../releases/artifacts.html">Artifacts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../developing-applications/index.html">Developing applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Developing modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../across-web/index.html">Across Web</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../testing/index.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/base-test-classes.html">Base test classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/test-context-builders.html">Test context builders</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/annotations.html">Annotations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/mock-mvc.html">Mock MVC integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/mock-across-servlet-context.html">MockAcrossServletContext</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/application-testing.html">Across application testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/test-dynamic-modules.html">Testing dynamic modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/test-datasources.html">Test datasources</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot/index.html">Autoconfiguration Support</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Across</span>
    <span class="version">3.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Across</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Application Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guides/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../migration/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Admin Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../admin-web-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Bootstrap UI</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../bootstrap-ui-module/2.0.1/index.html">2.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Documents & Forms</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dynamic-forms-module/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Entity Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../entity-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Hibernate JPA</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hibernate-jpa-module/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: LDAP Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ldap-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-security-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - ACLs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-security-acl-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - OAuth2</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../oauth2-module/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: User Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../user-module/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Web CMS</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../web-cms-module/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/ForeachOS/ax-docs-across/edit/develop/docs/modules/developing-modules/pages/chap-module-bootstrap.adoc">Edit this Page</a></div>
</div>
<article class="doc"><a name="section-top"></a>
<div class="sect1">
<h2 id="installers"><a class="anchor" href="#installers"></a>Installers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A module can have one or more installer classes.
The purpose of installers is setup data that modules need, before the actual application takes over.
Examples: creating database schema, installing default or test data&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>An <code>@Installer</code> annotation marks a class as an installer and allows you to specify the important installer attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">attribute</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional (unique) name of the installer.
If not specified, the fully qualified class name of the installer class will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptive text of what will be installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>phase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this installer should run during the context bootstrap.
See <a href="#installer-bootstrap-phases">bootstrap phases</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runCondition</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition when this installer should run.  See <a href="#installer-run-conditions">run conditions</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version number of the installer.
This value should be incremented to enforce a new run of the same installer.
Only relevant if the run condition is <code>VersionDifferent</code>.</p></td>
</tr>
</tbody>
</table>
<h3 id="_installer_detection" class="discrete">Installer detection</h3>
<div class="paragraph">
<p>By default installers are detected from the classpath by scanning the <strong>installers</strong> package relative to the package of the <code>AcrossModule</code>.
Changing the packages to scan for installers can be done by overriding the <code>getInstallerScanPackages()</code> method on <code>AcrossModule</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you manually want to specify a list of installers, you can do so by overriding the <code>getInstallers()</code> method.
Though still possible for compatibility reasons, installers should be specified with their <code>Class</code>.
</td>
</tr>
</table>
</div>
<h3 id="_installer_tracking_and_synchronization" class="discrete">Installer tracking and synchronization</h3>
<div class="paragraph">
<p>The execution of installers is tracked using the <code>AcrossInstallerRepository</code>.
This allows for installers to execute only if they have not yet been executed (see <a href="#installer-run-conditions">run conditions</a>).</p>
</div>
<div class="paragraph">
<p>In addition, installer execution is synchronized for multiple applications connecting on the same database.
This is done through the <code>DistributedLockRepository</code> that is created in the core schema.
A lock will be taken on the database as soon as a single installer wishes to execute, and will be released once that installer has finished executing.</p>
</div>
<div class="paragraph">
<p>The lock owner will contain the hostname of the computer running the application, as well as the <code>displayName</code> of the <code>AcrossContext</code>.</p>
</div>
<div class="paragraph">
<p>Because of tracking and synchronization, a <a href="#installer-datasource">datasource</a> is required in order to execute installers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>AcrossInstallerRepository</code> can be wired as a bean in installers.
This can be helpful in migration trajectories for example to rename installers.
</td>
</tr>
</table>
</div>
<h3 id="installer-bootstrap-phases" class="discrete">Bootstrap phases</h3>
<div class="paragraph">
<p>Installers are executed during a specific phase of the context bootstrap.
This phase should be specified for every installer.
The phase will determine which beans are available in the installer.</p>
</div>
<div class="paragraph">
<p>The following bootstrap phases exist:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BeforeContextBootstrap</dt>
<dd>
<p>The installer is executed before any of the modules in the AcrossContext are bootstrapped.
Only beans from the parent <code>ApplicationContext</code> or the <a href="#installer-applicationcontext">installer <code>ApplicationContext</code></a> are available.</p>
</dd>
<dt class="hdlist1">BeforeModuleBootstrap</dt>
<dd>
<p>The installer is executed before the module that owns it bootstraps, but after all previous modules have bootstrapped.
All beans from previous modules will also be available to the installer.</p>
</dd>
<dt class="hdlist1">AfterModuleBootstrap</dt>
<dd>
<p>The installer is executed after the module that owns it has bootstrapped, but before the next module bootstraps.
All beans from the current module are available.</p>
</dd>
<dt class="hdlist1">AfterContextBootstrap</dt>
<dd>
<p>The installer is executed after all modules have bootstrapped, but before the <code>AcrossContextBootstrappedEvent</code> is published.
All beans from all modules are available.</p>
</dd>
</dl>
</div>
<h3 id="installer-run-conditions" class="discrete">Run conditions</h3>
<div class="paragraph">
<p>The following run conditions are supported for an installer:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AlwaysRun</dt>
<dd>
<p>The installer will always be executed, everytime the module bootstraps.</p>
</dd>
<dt class="hdlist1">VersionDifferent</dt>
<dd>
<p>The installer will only execute if the <em>version</em> attribute is higher than the version previously executed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to the standard run conditions, you can use <a href="#installer-conditionals"><code>@Conditional</code> annotations on installer classes</a>.
This includes for example the use of <code>@AcrossDepends</code> to execute installers if certain modules are active.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using <strong>AlwaysRun</strong> installers will always cause the bootstrap lock to be taken.
 This might cause a slowdown when starting multiple applications on the same datasource simultaneously.
</td>
</tr>
</table>
</div>
<h3 id="_installer_group" class="discrete">Installer group</h3>
<div class="paragraph">
<p>In addition to the standard <code>@Installer</code> attributes, an <code>@InstallerGroup</code> annotation can be specified.
This allows grouping types of installers together (for example schema) and overruling their execution using <a href="#installer-settings"><code>InstallerSettings</code></a>.</p>
</div>
<h3 id="_installer_execution_order" class="discrete">Installer execution order</h3>
<div class="paragraph">
<p>If all conditions are fulfilled, installers will be executed in a predetermined order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in <a href="#installer-bootstrap-phases">bootstrap phase</a> order</p>
</li>
<li>
<p>in <a href="#">developing-applications.adoc#module-bootstrap-order</a></p>
</li>
<li>
<p>in installer order (according to <code>@Order</code> annotations on the installer class)</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Installers without an <code>@Order</code> annotation behave as if they have an order index of <strong>0</strong>.
In that case the installer registration order will be used as a fallback, with installers specified through <code>getInstallers()</code> having a higher precedence.
</td>
</tr>
</table>
</div>
<h3 id="installer-datasource" class="discrete">Datasources and installers</h3>
<div class="paragraph">
<p>An <code>AcrossContext</code> requires at least one datasource if modules need to run installers.
Certain core features like the <code>DistributedLockRepository</code> also require the core schema to be installed and will require a valid datasource to be configured.</p>
</div>
<div class="paragraph">
<p>The main datasource is available for all modules as a bean named <code>acrossDataSource</code>.
Optionally a separate installer datasource can be configured that will be available as <code>acrossInstallerDataSource</code>.
If no separate installer datasource is specified, the default across datasource will be used.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A valid default datasource is always required for installers to run.
It is not possible to configure only an installer datasource as the distributed locking mechanism uses the default datasource.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The installer datasource is the default datasource used for all <code>AcrossLiquibaseInstaller</code> instances.</p>
</div>
<h3 id="installer-applicationcontext" class="discrete">Installer ApplicationContext</h3>
<div class="paragraph">
<p>If installers need to be run for a module, a specific <code>ApplicationContext</code> is created in which the installers will be wired as beans.
This <code>ApplicationContext</code> can exist before the actual module <code>ApplicationContext</code> does.
However, all beans from the parent Across context and the module context - when created - are available in installers.</p>
</div>
<div class="paragraph">
<p>Installer contexts are temporary, once the Across context has bootstrapped they are closed.
Configuration and other annotated classes can be added to the installer context by using <code>ApplicationContextConfigurer</code> implementations, either on the <code>AcrossContext</code> or on an <code>AcrossModule</code>.</p>
</div>
<div class="paragraph">
<p>By default, the package <strong>installers.config</strong> relative to the module package will be scanned for beans to be added to the installer <code>ApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example using different datasource inside the modules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
class Config implements AcrossContextConfigurer
{
    /**
     * Installer tracking will be done on this datasource.
     */
    @Bean
    public EmbeddedDatabase acrossDataSource() {
        return new EmbeddedDatabaseBuilder()
                .setType( EmbeddedDatabaseType.HSQL )
                .setName( "core" )
                .build();
    }

    @Bean
    public EmbeddedDatabase moduleDataSource() {
        return new EmbeddedDatabaseBuilder()
                .setType( EmbeddedDatabaseType.HSQL )
                .setName( "data" )
                .build();
    }

    @Override
    public void configure( AcrossContext context ) {
        ProvidedBeansMap beans = new ProvidedBeansMap();
        beans.put( AcrossContext.DATASOURCE, new PrimarySingletonBean( moduleDataSource() ) );
        beans.put( AcrossContext.INSTALLER_DATASOURCE, moduleDataSource() );

        context.addApplicationContextConfigurer( new ProvidedBeansConfigurer( beans ),
                                                 ConfigurerScope.MODULES_ONLY );
        context.addInstallerContextConfigurer( new ProvidedBeansConfigurer( beans ) );
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The installer context has no web support as it is a direct implementation of <code>AcrossApplicationContext</code> but does not implement <code>WebApplicationContext</code>.
</td>
</tr>
</table>
</div>
<div id="installer-conditionals" class="paragraph">
<p>Installers are registered as bean definitions in the installer <code>ApplicationContext</code>.
You can use any Spring <code>@Conditional</code> annotations to suppress installer execution, even if the run conditions are fulfilled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When registering bean definitions to the installer context, a good practice is to demarcate beans as <code>@Lazy</code>.
 In that case they will never get created if the installer conditionals fail.
</td>
</tr>
</table>
</div>
<h3 id="_acrossliquibaseinstaller" class="discrete">AcrossLiquibaseInstaller</h3>
<div class="paragraph">
<p>Across core comes with an <code>AcrossLiquibaseInstaller</code> class.
This is an abstract base class for executing liquibase XML resources.
Simply extending the base class and annotating as installer will execute an XML resource in the same package as the installer class against the installer datasource.</p>
</div>
<div class="listingblock">
<div class="title">Example using different datasource inside the modules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package my.package;

@Installer(description = "Liquibase installer", runCondition = InstallerRunCondition.AlwaysRun)
public class LiquibaseInstaller extends AcrossLiquibaseInstaller
{
    // Will execute the resource file 'my/package/LiquibaseInstaller.xml'
    // As liquibase has its own locking mechanism, we can safely always run (even though you should avoid this when possible)

}</code></pre>
</div>
</div>
<h4 id="_schemaconfiguration" class="discrete">SchemaConfiguration</h4>
<div class="paragraph">
<p>An <code>AcrossLiquibaseInstaller</code> will use a <code>SchemaConfiguration</code> bean to configure its default schema and pass configuration properties.
A <code>SchemaConfiguration</code> for the current module will be looked up first, if none is found a default bean will be used if it exists.</p>
</div>
<div class="paragraph">
<p>The default <code>SchemaConfiguration</code> is a bean without any <code>@Module</code> annotations.
The presence of a <code>@Module</code> annotation marks that <code>SchemaConfiguration</code> as applying only for that particular module.</p>
</div>
<div class="paragraph">
<p>If no default or module <code>SchemaConfiguration</code> is found, the installer will continue without setting a default schema.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Adding <code>SchemaConfiguration</code> beans to a context directly via a <code>ProvidedBeansConfigurer</code> erases the visibility of bean declaration annotations.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of a configuration class defining some <code>SchemaConfiguration</code> beans</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package my.package;

@EnableAcrossContext
@Configuration
public class SchemaConfig
{
    /<strong>
     * AcrossLiquibaseInstaller in the QuotationModule will automatically pick up this SchemaConfiguration.
     * Liquibase scripts will run with 'MY_QUOTATIONS' as their default schema.
     */
     @Bean
     @Module( "QuotationModule" )
     public SchemaConfiguration userSchemaConfiguration() {
        return new SchemaConfiguration( "MY_QUOTATIONS" );
     }

     /</strong>
      * This is the default SchemaConfiguration.
      * AcrossLiquibaseInstaller in other module will pick up this SchemaConfiguration.
      */
     @Bean
     public SchemaConfiguration defaultSchemaConfiguration() {
        return new SchemaConfiguration( "MY_SCHEMA" );
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Fixing a default schema</div>
<p>Alternatively the <code>SchemaConfiguration</code> bean schema can be ignored and a default schema fixed on the <code>AcrossLiquibaseInstaller</code>.
This is done in the installer implementation through the <code>setDefaultSchema()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Example fixed schema configuration using <code>AcrossLiquibaseInstaller#setDefaultSchema</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package my.package;

/**
 * Liquibase script of this installer will run with 'IM_SPECIAL' as default schema.
 * Regardless of any defined SchemaConfiguration.
 */
@Installer(description = "Liquibase installer", runCondition = InstallerRunCondition.AlwaysRun)
public class SpecialSchemaInstaller extends AcrossLiquibaseInstaller
{
    public SpecialSchemaInstaller() {
        setDefaultSchema( "IM_SPECIAL" );
    }
}</code></pre>
</div>
</div>
<h3 id="installer-settings" class="discrete">InstallerSettings</h3>
<div class="paragraph">
<p>For advanced configuration, both <code>AcrossContext</code> and <code>AcrossModule</code> allow <code>InstallerSettings</code> to be set.
<code>InstallerSettings</code> can be used to set the action (eg. force executed, skip) to be performed for one or more installers or installer groups.</p>
</div>
<div class="paragraph">
<p><code>InstallerSettings</code> accepts an <code>InstallerActionResolver</code> for determining install action at runtime.
Alternatively an installer can implement <code>InstallerActionResolver</code> that will be used in a second stage only if the original action is <code>EXECUTE</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the javadoc for more information.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
<footer class="footer">
  <p>The Across documentation site is generated using <a href="https://antora.org" target="_blank">Antora</a>.</p>
  <div class="footer-totop">
    <!--srcset="/acrossWebsite/img/foreach-logo@2x.png 2x"-->
    <a class="footer-partner" href="http://foreach.be/" target="_blank">
      sponsored by <svg width="20" height="20" viewBox="0 0 277 311" xmlns="http://www.w3.org/2000/svg">
        <g fill="none" fill-rule="evenodd">
          <path d="M27 307.3V133.5H.9V92.7H27v-8.8c0-24.1 4.3-46.5 19.7-64.1C58.2 6.6 74.7.1 92.9.1c13.4 0 23.7 2.2 31.2 4.8l-5.9 44.8c-3.9-1.8-9.5-2.6-15.8-2.6-17.4 0-23.7 16.7-23.7 35.5v10.1h33.6v40.8H78.7v173.8H27z" fill="#FFCE01" fill-rule="nonzero"></path>
          <path d="M229.2 181c0-27.6-6.3-49.1-21.7-49.1-17 0-23.7 27.7-24.1 49.1h45.8zM183 221.4c.8 33.4 18.2 45.6 41.1 45.6 14.6 0 27.6-3.5 36.7-7l7.1 41.2c-13.4 5.7-33.6 9.7-53.3 9.7-52.5 0-81.4-38.6-81.4-105.8 0-72 33.6-115 77.4-115 41.5 0 65.6 36.4 65.6 101.4 0 15.4-.4 23.7-1.6 29.8H183v.1z" fill="#FFF" fill-rule="nonzero"></path>
        </g>
      </svg>
    </a>
    <a href="#section-top">
      <svg width="34" height="34" viewBox="0 0 62 62" xmlns="http://www.w3.org/2000/svg">
        <title>icon</title>
        <g transform="rotate(-90 30.5 30.5)" fill="none" fill-rule="evenodd">
          <circle stroke="#ffffff" fill="#1D2A3A" transform="rotate(180 30.007 30.942)" cx="30.007" cy="30.942" r="30"></circle>
          <path fill="#ffffff" d="M25 38.884h3.713l6.3-7.797-6.3-8.087-3.713.064 6.155 7.972"></path>
        </g>
      </svg>
    </a>
  </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                 tocSelector: '#article-toc',
                 contentSelector: 'article',
                 headingSelector: 'h2, h3, h4, h5',
                 collapseDepth: 3,
                 positionFixedSelector: '#article-toc',
                 scrollSmooth: false
               } );
</script>
  </body>
</html>
