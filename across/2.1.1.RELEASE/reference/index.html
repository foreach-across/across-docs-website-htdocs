<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Arne Vandamme, Marc Vanbrabant, Andy Debrouwer">
<title>Across framework</title>
<style>
/*
 * Copyright 2014 the original author or authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
@import url(https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400,700);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

pre > code { font-size: 0.8em; line-height: 1; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Across framework</h1>
<div class="details">
<span id="author" class="author">Arne Vandamme, Marc Vanbrabant, Andy Debrouwer</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#whats-new">What&#8217;s new in this version?</a>
<ul class="sectlevel2">
<li><a href="#_2_1_1_release">2.1.1.RELEASE</a></li>
<li><a href="#_2_1_0_release">2.1.0.RELEASE</a></li>
<li><a href="#_2_0_0_release">2.0.0.RELEASE</a></li>
<li><a href="#_1_1_3_release">1.1.3.RELEASE</a></li>
<li><a href="#_1_1_2_release">1.1.2.RELEASE</a></li>
<li><a href="#_1_1_1_release">1.1.1.RELEASE</a></li>
</ul>
</li>
<li><a href="#_across_in_a_nutshell">Across in a nutshell</a></li>
<li><a href="#fundamentals">Fundamentals</a>
<ul class="sectlevel1">
<li><a href="#_required_knowledge">1. Required knowledge</a></li>
<li><a href="#_technical_requirements">2. Technical requirements</a></li>
<li><a href="#_across_framework">3. Across Framework</a></li>
<li><a href="#across-platform">4. Across Platform</a></li>
<li><a href="#across-standard-modules">5. Across Standard Modules</a></li>
<li><a href="#_core_concepts">6. Core concepts</a>
<ul class="sectlevel2">
<li><a href="#_application_context_module">6.1. Application/Context/Module</a></li>
<li><a href="#_module_dependencies">6.2. Module dependencies</a></li>
<li><a href="#_bootstrapping">6.3. Bootstrapping</a></li>
<li><a href="#_exposing_beans">6.4. Exposing beans</a></li>
<li><a href="#_events">6.5. Events</a></li>
<li><a href="#_installers">6.6. Installers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_framework_artifacts">Framework artifacts</a></li>
<li><a href="#developing-across-applications">Developing Across applications</a>
<ul class="sectlevel1">
<li><a href="#_creating_an_across_application">1. Creating an Across application</a>
<ul class="sectlevel2">
<li><a href="#enableacrosscontext">1.1. @EnableAcrossContext</a></li>
<li><a href="#across-application">1.2. @AcrossApplication</a></li>
</ul>
</li>
<li><a href="#_module_configuration">2. Module configuration</a></li>
<li><a href="#across-bootstrap">3. Across bootstrap</a>
<ul class="sectlevel2">
<li><a href="#across-bootstrap-order">3.1. Module bootstrap order</a></li>
<li><a href="#_installers_2">3.2. Installers</a></li>
<li><a href="#_bootstrap_events">3.3. Bootstrap events</a></li>
</ul>
</li>
<li><a href="#_properties">4. Properties</a></li>
<li><a href="#across-datasource">5. Across datasource</a></li>
<li><a href="#events">6. Events</a></li>
<li><a href="#refreshing">7. Refreshing</a>
<ul class="sectlevel2">
<li><a href="#__refreshable">7.1. @Refreshable</a></li>
<li><a href="#__postrefresh">7.2. @PostRefresh</a></li>
<li><a href="#__refreshablecollection">7.3. @RefreshableCollection</a></li>
<li><a href="#RefreshableRegistry">7.4. RefreshableRegistry</a></li>
</ul>
</li>
<li><a href="#ordering-beans">8. Bean order</a></li>
<li><a href="#_conversionservice">9. ConversionService</a></li>
<li><a href="#development-mode">10. Development mode</a></li>
</ul>
</li>
<li><a href="#developing-across-modules">Developing Across modules</a>
<ul class="sectlevel1">
<li><a href="#creating-an-acrossmodule">1. Creating an AcrossModule</a></li>
<li><a href="#_module_dependencies_2">2. Module dependencies</a>
<ul class="sectlevel2">
<li><a href="#__acrossdepends">2.1. @AcrossDepends</a></li>
<li><a href="#_conditionals">2.2. Conditionals</a></li>
</ul>
</li>
<li><a href="#_bootstrap_interaction">3. Bootstrap interaction</a>
<ul class="sectlevel2">
<li><a href="#moduleconfiguration">3.1. @ModuleConfiguration</a></li>
<li><a href="#_subscribe_to_events">3.2. Subscribe to events</a></li>
<li><a href="#_customizing_your_module_descriptor">3.3. Customizing your module descriptor</a></li>
</ul>
</li>
<li><a href="#exposing-beans">4. Exposing beans</a></li>
<li><a href="#message-source">5. Message sources</a>
<ul class="sectlevel2">
<li><a href="#auto-detecting-message-sources">5.1. Auto-detecting message sources</a></li>
<li><a href="#_message_source_hierarchy">5.2. Message source hierarchy</a></li>
</ul>
</li>
<li><a href="#installers">6. Installers</a></li>
<li><a href="#_module_version_information">7. Module version information</a></li>
</ul>
</li>
<li><a href="#across-web">AcrossWebModule</a>
<ul class="sectlevel1">
<li><a href="#_general_information">1. General information</a>
<ul class="sectlevel2">
<li><a href="#_about">1.1. About</a></li>
<li><a href="#_artifact_2">1.2. Artifact</a></li>
<li><a href="#across-web-module-settings">1.3. Module settings</a></li>
</ul>
</li>
<li><a href="#_spring_mvc_configuration">2. Spring MVC configuration</a></li>
<li><a href="#_acrosswebmodule_and_conversionservice">3. AcrossWebModule and ConversionService</a></li>
<li><a href="#_view_engines">4. View engines</a>
<ul class="sectlevel2">
<li><a href="#_thymeleaf_support">4.1. Thymeleaf support</a></li>
<li><a href="#_jsp_support">4.2. JSP support</a></li>
</ul>
</li>
<li><a href="#static-resources">5. Static resources</a>
<ul class="sectlevel2">
<li><a href="#static-resources-conventions">5.1. Conventions</a></li>
<li><a href="#client-side-caching">5.2. Client-side caching</a></li>
<li><a href="#resource-url-versioning">5.3. Resource URL versioning</a></li>
<li><a href="#WebResourceRegistry">5.4. WebResourceRegistry</a></li>
</ul>
</li>
<li><a href="#menu-building">6. Building menus</a></li>
<li><a href="#view-elements">7. ViewElement infrastructure</a>
<ul class="sectlevel2">
<li><a href="#_viewelement">7.1. ViewElement</a></li>
<li><a href="#_default_properties">7.2. Default properties</a></li>
<li><a href="#_viewelementbuilder">7.3. ViewElementBuilder</a></li>
<li><a href="#dev-mode-rendering">7.4. Development mode rendering</a></li>
</ul>
</li>
<li><a href="#web-templates">8. Layout templates</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_template">8.1. Creating a template</a></li>
<li><a href="#_linking_a_template_to_a_controller">8.2. Linking a template to a controller</a></li>
<li><a href="#_linking_a_template_to_an_exception_handler">8.3. Linking a template to an exception handler</a></li>
<li><a href="#_registering_the_default_template">8.4. Registering the default template</a></li>
</ul>
</li>
<li><a href="#_partial_rendering">9. Partial rendering</a></li>
<li><a href="#localized-text">10. Localizing text</a></li>
<li><a href="#_generating_urls">11. Generating URLs</a>
<ul class="sectlevel2">
<li><a href="#web-app-path-resolver">11.1. WebAppPathResolver and path prefixing</a></li>
<li><a href="#_webapplinkbuilder">11.2. WebAppLinkBuilder</a></li>
</ul>
</li>
<li><a href="#thymeleaf-dialect">12. Thymeleaf dialect</a>
<ul class="sectlevel2">
<li><a href="#_element_processors">12.1. Element processors</a></li>
<li><a href="#_attribute_processors">12.2. Attribute processors</a></li>
<li><a href="#_expression_objects">12.3. Expression objects</a></li>
<li><a href="#url-support">12.4. URL support</a></li>
</ul>
</li>
<li><a href="#extended-request-mapping">13. @RequestMapping extensions</a>
<ul class="sectlevel2">
<li><a href="#customrequestcondition">13.1. @CustomRequestMapping</a></li>
<li><a href="#prefix-request-mappings">13.2. Prefixed request mappings</a></li>
</ul>
</li>
<li><a href="#default-http-encoding">14. Default HTTP encoding</a></li>
<li><a href="#dynamic-servlet-registration">15. Registering servlets and filters</a></li>
<li><a href="#multipart-config">16. Multipart support</a></li>
<li><a href="#_development_mode_support">17. Development mode support</a></li>
<li><a href="#_published_events">18. Published events</a></li>
</ul>
</li>
<li><a href="#across-test">Testing</a>
<ul class="sectlevel1">
<li><a href="#_base_test_classes">1. Base test classes</a></li>
<li><a href="#test-builders">2. Test context builders</a></li>
<li><a href="#test-annotations">3. Annotations</a>
<ul class="sectlevel2">
<li><a href="#annotation-across-test-configuration">3.1. @AcrossTestConfiguration</a></li>
<li><a href="#acrosswebappconfiguration">3.2. @AcrossWebAppConfiguration</a></li>
</ul>
</li>
<li><a href="#_mock_mvc_integration">4. Mock MVC integration</a></li>
<li><a href="#mock-across-servlet-context">5. MockAcrossServletContext</a></li>
<li><a href="#_across_application_testing">6. Across application testing</a>
<ul class="sectlevel2">
<li><a href="#__webintegrationtest">6.1. @WebIntegrationTest</a></li>
<li><a href="#boot-integration-test-mockmvc">6.2. Integration test with MockMvc support</a></li>
</ul>
</li>
<li><a href="#_testing_dynamic_modules">7. Testing dynamic modules</a></li>
<li><a href="#test-datasources">8. Test datasources</a></li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a>
<ul class="sectlevel1">
<li><a href="#_troubleshooting">1. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_module_not_found">1.1. Module not found</a></li>
</ul>
</li>
<li><a href="#_across_core_events">2. Across core events</a></li>
<li><a href="#_across_core_components">3. Across core components</a></li>
<li><a href="#appendix-test-configuration-classes">4. Test configuration classes</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="openblock copyright">
<div class="content">
<div class="paragraph">
<p>Copyright &#169; 2014-2017<br>
<span class="small">Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting started</h3>
<div class="paragraph">
<p>The reference documentation is split up into several parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#whats-new">What&#8217;s new in this version</a> lists the release notes of the Across framework</p>
</li>
<li>
<p><a href="#fundamentals">Fundamentals</a> explains the fundamental concepts of Across, things you should really understand when building Across applications or modules</p>
</li>
<li>
<p><a href="#developing-across-applications">Developing Across applications</a> goes into some more detail about the steps involved in developing application with Across modules, as well as some of the features you can use</p>
</li>
<li>
<p><a href="#developing-across-modules">Developing Across modules</a> is more geared towards developers interested in creating shared modules - although the information is generally useful</p>
</li>
<li>
<p><a href="#across-web">AcrossWebModule</a> gives an overview of the web specific additions that Across core brings</p>
</li>
<li>
<p><a href="#across-test">Testing</a> explains how developers can integration test their modules or applications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Through the <a href="http://across.foreach.be">Across website</a> you can find a lot more information like frequently asked questions, tutorials and available modules (with their respective documentation).</p>
</div>
</div>
<div class="sect1">
<h2 id="whats-new"><a class="anchor" href="#whats-new"></a>What&#8217;s new in this version?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_2_1_1_release"><a class="anchor" href="#_2_1_1_release"></a>2.1.1.RELEASE</h3>
<div class="paragraph">
<p><strong>Across Core</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>minor performance improvements</p>
</li>
<li>
<p><code>@PostRefresh</code> now supports method arguments, behaving as an equivalent of <code>@Autowired</code> but after the Across context has bootstrapped</p>
<div class="ulist">
<ul>
<li>
<p>it is also possible to indicate that dependencies are not required, if dependencies are not met, the method will not be executed</p>
</li>
<li>
<p><code>@PostRefresh</code> methods can be called more than once if a parent <code>ApplicationContext</code> refreshes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Across Test</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>bug fixes:</p>
<div class="ulist">
<ul>
<li>
<p>test datasource is generated with a unique name - this improves the re-use of the main <code>ApplicationContext</code> without the need for <code>@DirtiesContext</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_2_1_0_release"><a class="anchor" href="#_2_1_0_release"></a>2.1.0.RELEASE</h3>
<div class="paragraph">
<p><strong>Across Core</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>bootstrap locking changes</p>
<div class="ulist">
<ul>
<li>
<p>the bootstrap lock is now taken and released per installer instead of once for the entire bootstrap phase</p>
</li>
<li>
<p>lock owner id is prefixed with both the <code>AcrossContext#displayName</code> and the hostname of the server</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#event-handler-ordering">event handlers are now executed in module bootstrap order</a>: event handlers from a previous module will have been executed when yours is called</p>
<div class="ulist">
<ul>
<li>
<p>this removes an old limitation of event handling in Across</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>AcrossWebModule</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@AcrossApplication</code> has a <code>displayName</code> attribute to configure the context display name</p>
<div class="ulist">
<ul>
<li>
<p>if empty, the property value of <strong>across.displayName</strong> will be considered instead</p>
</li>
</ul>
</div>
</li>
<li>
<p>added <code>LocalizedTextResolver</code> for <a href="#localized-text">generic localization of text snippets</a></p>
<div class="ulist">
<ul>
<li>
<p><code>ViewElementBuilderContext</code> also implements text and message code resolving (see <a href="https://foreach.atlassian.net/wiki/display/AX/BootstrapUiModule">BootstrapUiModule</a> documentation)</p>
</li>
</ul>
</div>
</li>
<li>
<p>the default Thymeleaf resolvers now support templates with <strong>*.html</strong> suffix</p>
<div class="ulist">
<ul>
<li>
<p><em>.html</em> extension is now preferred as text editors will automatically recognize the template as html</p>
</li>
<li>
<p><em>.thtml</em> extension is still fully supported but support may be removed in a future major release</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_2_0_0_release"><a class="anchor" href="#_2_0_0_release"></a>2.0.0.RELEASE</h3>
<div class="paragraph">
<p>Upgrade to <strong>Spring Platform Athens</strong>, new major dependency versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring framework 4.3.x</p>
</li>
<li>
<p>Spring Boot 1.4.x</p>
</li>
<li>
<p>Thymeleaf 3.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Across Core</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@AcrossEventHandler</code> has been deprecated, all beans are now automatically scanned for <code>@Event</code> methods</p>
</li>
<li>
<p>the <code>AcrossEventPublisher</code> interface has some MBassador specific methods removed</p>
<div class="ulist">
<ul>
<li>
<p>note that the backing implementation of the event bus might change in the future, applications should avoid using MBassdor specific features</p>
</li>
</ul>
</div>
</li>
<li>
<p>development mode will register a default resources directory for dynamic modules</p>
<div class="ulist">
<ul>
<li>
<p>this will be an existing <strong>src/main/resources</strong> folder relative to the working directory of the running application</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>@ConditionalOnDevelopmentMode</code> added to detect if development mode is active</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Across Test</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The spring-boot-test dependency is now part of across-test</p>
</li>
<li>
<p>Updated documentation to use the new <code>@SpringBootTest</code> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>AcrossWebModule</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServletContextInitializer</code> beans in modules are now supported directly for customizing the <code>ServletContext</code></p>
<div class="ulist">
<ul>
<li>
<p><code>@ConditionalOnConfigurableServletContext</code> and <code>@ConditionalOnNotConfigurableServletContext</code> added to determine if <code>ServletContext</code> can still be customized</p>
</li>
<li>
<p>favour the use of <code>FilterRegistrationBean</code> or <code>ServletRegistrationBean</code> instead of <code>AcrossWebDynamicServletConfigurer</code>, the latter is now deprecated and will be removed in a future release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Spring Boot devtools are now supported - application context restart will be triggered by default if devtools is on the classpath</p>
</li>
<li>
<p>AcrossWebModule now ensures that all <code>HandlerMapping</code> beans from other modules are exposed</p>
</li>
<li>
<p>a path prefix <strong>@static</strong> and <strong>@resource</strong> is registered to <a href="#web-app-path-resolver">link to static resources</a></p>
</li>
<li>
<p><a href="#thymeleaf-dialect">Thymeleaf dialect</a> extensions</p>
<div class="ulist">
<ul>
<li>
<p>using <a href="#web-app-path-resolver">prefixes</a> directly in url expressions is now supported</p>
</li>
<li>
<p>addition of <strong>across:static</strong> and <strong>across:resource</strong> attributes for generating links to static resources</p>
</li>
</ul>
</div>
</li>
<li>
<p>add infrastructure for defining <a href="#customrequestcondition">custom request mapping conditions</a> using <code>@CustomRequestMapping</code> and <code>CustomRequestCondition</code></p>
</li>
<li>
<p>partial rendering of a single <code>ViewElement</code> is now also supported (see <a href="https://foreach.atlassian.net/wiki/display/AX/BootstrapUiModule">BootstrapUiModule</a> documentation).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_3_release"><a class="anchor" href="#_1_1_3_release"></a>1.1.3.RELEASE</h3>
<div class="paragraph">
<p>Maintenance release containing several bugfixes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_2_release"><a class="anchor" href="#_1_1_2_release"></a>1.1.2.RELEASE</h3>
<div class="paragraph">
<p><strong>Across Core</strong></p>
</div>
<div class="paragraph">
<p>Across now requires JDK8 and has improved support for Spring Boot.
The latter is also a required dependency as of 1.1.2.
A lot of improvements have been done to reduce the amount of boilerplate code necessary to create a new <code>AcrossContext</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enableacrosscontext">@EnableAcrossContext</a> annotation now supports autoconfiguration of an <code>AcrossContext</code></p>
</li>
<li>
<p><a href="#moduleconfiguration">@ModuleConfiguration</a> annotation provides a no-hassle way to declare annotated classes that need to be added to a specific module</p>
</li>
<li>
<p>message sources are now <a href="#auto-detecting-message-sources">auto-detected</a> if they follow the conventions</p>
</li>
<li>
<p>both <code>AcrossModule</code> and <code>ModuleBootstrapConfig</code> now have shortcut <code>expose()</code> methods that make it easier to expose additional beans</p>
</li>
<li>
<p>several changes and improvements were made to installers:</p>
<div class="ulist">
<ul>
<li>
<p>installers are now created in their own configurable <a href="#installer-applicationcontext">installer <code>ApplicationContext</code></a></p>
</li>
<li>
<p>installers are detected automatically through classpath scanning (defaults to <strong>installers</strong> package of a module)</p>
</li>
<li>
<p>installers are ordered based on the presence of an <code>@Order</code> annotation</p>
</li>
<li>
<p>installers now support <code>@Conditional</code> annotations for building more complex conditions</p>
</li>
<li>
<p>installers should only be specified as class names in <code>getInstallers()</code>, the use of instances is deprecated</p>
</li>
<li>
<p><code>InstallerSettings</code> has been refactored to use <code>InstallerMetaData</code> instead (breaking change)</p>
</li>
<li>
<p>installers can implement <code>InstallerActionResolver</code> directly to suppress execution at runtime</p>
</li>
<li>
<p><code>AcrossInstallerRepository</code> now has methods to rename installers</p>
</li>
<li>
<p><code>AcrossLiquibaseInstaller</code> detects the most appropriate <code>SchemaConfiguration</code> to use and modifies default schema accordingly</p>
</li>
</ul>
</div>
</li>
<li>
<p>development mode can be set through the property <strong>across.development.active</strong> and is active by default if a Spring profile called <strong>dev</strong> is active</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>AcrossWebModule</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#across-application">@AcrossApplication</a> can be used with <code>SpringApplication</code> to bootstrap an Across context with dynamic modules and support for embedded servlet containers</p>
</li>
<li>
<p>async configuration can now correctly be set through <code>WebMvcConfigurer#configureAsyncSupport(AsyncSupportConfigurer)</code></p>
</li>
<li>
<p><code>AcrossWebModuleSettings</code> has been refactored and <code>AcrossWebModule</code> can now be <a href="#across-web-module-settings">configured through properties</a></p>
<div class="ulist">
<ul>
<li>
<p>properties support Spring configuration metadata with possible IDE support</p>
</li>
</ul>
</div>
</li>
<li>
<p>by default only Thymeleaf views support is activated (breaking change)</p>
</li>
<li>
<p>static resources now configure default <a href="#client-side-caching">client-side caching</a> and <a href="#resource-url-versioning">resource url versioning</a></p>
</li>
<li>
<p><a href="#dynamic-servlet-registration">dynamic registration of servlets and filters</a> now supports ordering</p>
</li>
<li>
<p><a href="#default-http-encoding">default HTTP encoding</a> is now forced to UTF-8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Across Test</strong></p>
</div>
<div class="paragraph">
<p>Several improvements have been done for easier integration testing of modules in a web context.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test-builders">test context builders</a> have been added for easy configuration of an <code>AcrossContext</code> in test methods</p>
</li>
<li>
<p><a href="#mock-across-servlet-context">MockAcrossServletContext</a> can now be used for testing of dynamic <code>ServletContext</code> configuration</p>
</li>
<li>
<p>addition of a <code>AcrossMockMvcBuilders</code> class for creating a <code>MockMvcBuilder</code> based on an <code>AcrossContext</code></p>
<div class="ulist">
<ul>
<li>
<p>both <a href="#test-annotations">annotations</a> and <a href="#test-builders">builders</a> now provide a singleton <code>MockMvc</code> instance that is initialized with the bootstrapped context and all dynamically registered filters</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_1_release"><a class="anchor" href="#_1_1_1_release"></a>1.1.1.RELEASE</h3>
<div class="paragraph">
<p>Initial public release available on <a href="http://search.maven.org/">Maven central</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_across_in_a_nutshell"><a class="anchor" href="#_across_in_a_nutshell"></a>Across in a nutshell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across is a Java framework for developing your application using a modular approach.
It is built on top of Spring framework and provides a way to define application modules as well as the infrastructure to run the entire application.</p>
</div>
<div class="paragraph">
<p><strong>An Across module</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>bundles technical or business domain functionality,</p>
</li>
<li>
<p>explicitly depends on zero or more other modules,</p>
</li>
<li>
<p>exposes components like services or repositories for other modules to use,</p>
</li>
<li>
<p>uses exposed components from other modules,</p>
</li>
<li>
<p>has zero or more installers taking care of things like initial data creation or schema migrations,</p>
</li>
<li>
<p>is a single Spring <code>ApplicationContext</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>An Across application</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifies the modules to use,</p>
</li>
<li>
<p>sets up common infrastructure (eg. the event bus),</p>
</li>
<li>
<p>ensures modules are ordered according to their dependencies and bootstrapped in that same order,</p>
</li>
<li>
<p>runs as a Spring Boot application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Across applications force you to use the modular approach as much as possible.</p>
</div>
<div class="paragraph">
<p>Across is free and open source, published under an Apache 2.0 license.</p>
</div>
</div>
</div>
<h1 id="fundamentals" class="sect0"><a class="anchor" href="#fundamentals"></a>Fundamentals</h1>
<div class="paragraph">
<p>This chapter explains the terminology and fundamental concepts involved with developing Across applications and modules.
Understanding these terms and concepts is a prerequisite for working with Across.</p>
</div>
<div class="sect1">
<h2 id="_required_knowledge"><a class="anchor" href="#_required_knowledge"></a>1. Required knowledge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be able to develop with Across, you need a good grasp of Java (8) and Spring Framework.
Spring MVC experience is strongly advised, and some Spring Boot knowledge might be helpful.</p>
</div>
<div class="paragraph">
<p>At the very least you should be familiar with Spring’s approach for dependency injection, the <code>ApplicationContext</code> and java-based configuration.</p>
</div>
<div class="paragraph">
<p>Other commonly used libraries that are useful to know are <a href="http://hibernate.org/orm/">Hibernate</a>, <a href="http://projects.spring.io/spring-data/">Spring Data</a>, <a href="http://www.liquibase.org/">Liquibase</a> and <a href="http://www.thymeleaf.org">Thymeleaf</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_requirements"><a class="anchor" href="#_technical_requirements"></a>2. Technical requirements</h2>
<div class="sectionbody">
<h3 id="_across_and_spring_framework" class="discrete">Across and Spring framework</h3>
<div class="paragraph">
<p><a href="http://projects.spring.io/spring-framework/">Spring framework</a> is a de facto industry standard for building Java (web) applications.
It was a logical choice to use it as the foundation for Across.
Across extends or even customizes some aspects of Spring, but still supports most if not all common Spring functions out of the box.
To optimally use Across, a good knowledge of Spring is required.</p>
</div>
<div class="paragraph">
<p>Across is primarily built on top of Spring framework, but also includes some <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> dependencies.
Some features of Spring Boot are being used but an Across application is structured differently from a regular Spring Boot application, and as such compatibility is limited.
Most notable is the fact auto-configuration using Spring Boot starters is not supported.</p>
</div>
<div class="paragraph">
<p>Other modules often integrate different packages from the Spring ecosystem.
In the <a href="#across-standard-modules">standard modules</a> for example, there are modules building on top of <a href="http://projects.spring.io/spring-data/">Spring Data</a>, <a href="http://projects.spring.io/spring-batch/">Spring Batch</a> and <a href="http://projects.spring.io/spring-security/">Spring security</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_across_framework"><a class="anchor" href="#_across_framework"></a>3. Across Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across Framework is the actual Java library providing all the infrastructure necessary to build Across modules and to run applications based on them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="across-platform"><a class="anchor" href="#across-platform"></a>4. Across Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across Platform is a set of curated dependencies and Across modules that play well together and help developers assemble applications.
It is provided as a bill-of-material POM, extending the Spring IO platform BOM.</p>
</div>
<div class="paragraph">
<p>Across applications usually use the Across Platform BOM as a basis, to ensure that both third-party libraries as well as common Across modules are compatible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="across-standard-modules"><a class="anchor" href="#across-standard-modules"></a>5. Across Standard Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apart from the Across framework itself, there is a set of Across Standard Modules.
These modules are usually maintained by the Across core team.
They provide a common set of functionality that can be used as the foundation for your application.</p>
</div>
<div class="paragraph">
<p>There are standard modules that provide you with the set-up for an administrative web interface, secured with <a href="http://projects.spring.io/spring-security/">Spring security</a> and built on top of an entire roles and permissions management domain layer.
Other modules generate web forms at runtime for persistent entities you have declared in your application.</p>
</div>
<div class="paragraph">
<p>Across framework provides only a ground layer, the real win is in re-using well-defined modules that have already been built.
The standard modules projects aims to do exactly that: bring some generic base modules to the open source Across landscape.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_concepts"><a class="anchor" href="#_core_concepts"></a>6. Core concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the heart of Across are a couple of concepts you should understand.  The terms related tot these concepts are used
throughout all Across documentation, consider them part of the Across <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>.</p>
</div>
<div class="sect2">
<h3 id="_application_context_module"><a class="anchor" href="#_application_context_module"></a>6.1. Application/Context/Module</h3>
<div class="sect3">
<h4 id="_across_application"><a class="anchor" href="#_across_application"></a>6.1.1. Across application</h4>
<div class="paragraph">
<p>An Across application is an application built on top of Across modules.
These can be shared Across modules and/or dynamic modules like the Across application module.</p>
</div>
<div class="sect4">
<h5 id="discrete"><a class="anchor" href="#discrete"></a>Across application module</h5>
<div class="paragraph">
<p>The Across application module is a single special module in your application, it is the one containing your application specific logic.
The application module is always considered to depend on all other “shared” modules, and as such is started as the last module (with the exception of possible specialized postprocessor modules).</p>
</div>
<div class="paragraph">
<p>Shared modules have an explicit module descriptor, whereas the application module has an implicit one that is derived from the name and package of the <code>@AcrossApplication</code> annotated class.
The application module is determined using a convention-over-configuration approach, see the <a href="#dynamic-across-modules">chapter on dynamic modules</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_across_context"><a class="anchor" href="#_across_context"></a>6.1.2. Across context</h4>
<div class="paragraph">
<p>The Across context is the set of configured modules that make up the application.
There is a single configured Across context in an Across application.</p>
</div>
<div class="paragraph">
<p>The Across context represents a Spring <code>ApplicationContext</code> that is also the parent <code>ApplicationContext</code> of every module that belongs to the Across context.
Usually the Across context itself has a parent <code>ApplicationContext</code>, for example the <code>EmbeddedWebApplicationContext</code> of a Spring Boot application.</p>
</div>
<div class="paragraph">
<p>You can configure the Across context using the <code>@EnableAcrossContext</code> annotation.
When you use <code>@AcrossApplication</code>, this is already done behind the scenes.
<code>@AcrossApplication</code> sets up a Spring Boot application with a single Across context.</p>
</div>
<div class="paragraph">
<p>In code, the Across context is represented as an instance of <code>AcrossContext</code>.</p>
</div>
<div class="paragraph">
<div class="title">Terminology</div>
<p>When referring to the Across application, we refer to the entire <code>ApplicationContext</code> hierarchy, including the Across context and all its optional parents.
When referring to the Across context, we refer only to the <code>ApplicationContext</code> hierarchy of the individual Across modules and their direct parent.</p>
</div>
</div>
<div class="sect3">
<h4 id="_across_module"><a class="anchor" href="#_across_module"></a>6.1.3. Across module</h4>
<div class="paragraph">
<p>An Across module bundles technical or business domain functionality, most often the latter.
It represents a single Spring <code>ApplicationContext</code> that holds all the components the module defines and - optionally - makes these components available to other modules.</p>
</div>
<div class="paragraph">
<p>Across modules can depend on other modules.
These dependencies will determine the relative order of a module versus other modules in the same application.
A module will start (or ‘bootstrap’) after all the modules it depends on have already started.
During the bootstrap phase a module can perform one or more initialization tasks through special installer components.</p>
</div>
<div class="paragraph">
<p>An Across application is usually made up of multiple Across modules.
Most often a single Across module corresponds with a single JAR file, but this is in no way an actual requirement.
Every Across module has a unique name, and a single <a href="#creating-an-acrossmodule">module descriptor</a> that describes the basic configuration of the module.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_dependencies"><a class="anchor" href="#_module_dependencies"></a>6.2. Module dependencies</h3>
<div class="paragraph">
<p>Modules can depend on other modules.
If module B depends on module A, B states explicitly that it wishes to make use of the functionality that A will provide.
The module dependencies will determine the loading order of the modules in the configured Across context.</p>
</div>
<div class="paragraph">
<p>Modules have two types of dependencies on other modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explicit dependencies usually configured with &lt;&lt;`@AcrossDepends`&gt;&gt;</p>
</li>
<li>
<p>implicit dependencies defined by the <a href="#module role">[module role]</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Ordering of modules and components</div>
<p>The starting order of modules is determined at startup time by the dependency, and never changed after.
It is used throughout an Across application and expected to be very reliable: if module B depends on A, the functionality will be available when A starts.</p>
</div>
<div class="paragraph">
<p>This ordering is often used by modules to allow other modules to build on top initial configuration that has been done.
Events for example are also handled in order: if module B depends on A, A will handle an event before an event handler in B is called.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bootstrapping"><a class="anchor" href="#_bootstrapping"></a>6.3. Bootstrapping</h3>
<div class="paragraph">
<p>The Across bootstrap is the actual starting of the application.
During the bootstrapping phase the entire Spring <code>ApplicationContext</code> hierarchy of an application is created.</p>
</div>
<div class="paragraph">
<p>First the initial Across context is started, which determines the modules to start and assigns them a fixed order based on their dependencies.
Then the modules are started - bootstrapped - one after the other in the order assigned.
Only when all modules have started is control given back to the (optional) parent <code>ApplicationContext</code>.</p>
</div>
<div class="paragraph">
<p>An <code>AcrossContext</code> is only successfully bootstrapped if all modules have bootstrapped successfully.</p>
</div>
<div class="paragraph">
<p>If an Across context is being shutdown, first the modules are stopped in reverse order before the actual Across context is closed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exposing_beans"><a class="anchor" href="#_exposing_beans"></a>6.4. Exposing beans</h3>
<div class="paragraph">
<p>Exposing beans or components is making them available for other modules.</p>
</div>
<div class="paragraph">
<p>Module B can only use a service of module A if module A has explicitly exposed that service.
A service is usually provided through one or more beans, so that means that module A must expose those beans to its owning Across context.
If that has been done, beans from module B can simply wire the beans from module A directly.
Exposing components is the means through which module collaboration is defined.</p>
</div>
<div class="paragraph">
<p>There are several ways to expose beans, but in most cases it is done by annotating the bean or its implementing class with @Exposed.</p>
</div>
<div class="sect3">
<h4 id="_refreshing_beans"><a class="anchor" href="#_refreshing_beans"></a>6.4.1. Refreshing beans</h4>
<div class="paragraph">
<p>Sometimes it is not possible to define explicit dependencies between modules.
For example where module B depends on module A but creates a bean that A should use.
Because circular dependencies are not allowed the only solution for this would be to use either a lazy approach, or a <a href="#refreshable beans">refreshing mechanism</a>.</p>
</div>
<div class="paragraph">
<p>Much like refreshing an <code>ApplicationContext</code>, once all modules in an Across context are started, a refresh is triggered that allows modules to perform actions.</p>
</div>
<div class="paragraph">
<p>As much as possible, dependencies should be explicit and one way only.
The use of refresh is best to be kept to a minimum to have a clearer flow of control.
Using events can sometimes be a better alternative.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_events"><a class="anchor" href="#_events"></a>6.5. Events</h3>
<div class="paragraph">
<p>An Across context creates a central event bus that every module has access to.
Any bean can publish events on the bus, and special listeners can catch and handle the events published.</p>
</div>
<div class="paragraph">
<p>Using events is a common way for modules to provide extensions points to other modules, without forcing dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installers"><a class="anchor" href="#_installers"></a>6.6. Installers</h3>
<div class="paragraph">
<p>An Across module can define any number of installer components.
Installers are special beans that will only exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>during the bootstrapping of the Across context</p>
</li>
<li>
<p>if all conditions for the installers apply</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Installers can be used to setup the necessary infrastructure for the services that a module provides.
Common use cases for installers include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>installing a database schema</p>
</li>
<li>
<p>inserting (test) data</p>
</li>
<li>
<p>running migration tasks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Across itself provides the mechanism for defining installers and optimizing (conditional) installer execution.</p>
</div>
</div>
</div>
</div>
<h1 id="_framework_artifacts" class="sect0"><a class="anchor" href="#_framework_artifacts"></a>Framework artifacts</h1>
<div class="paragraph">
<p>Across framework itself consists of 3 library artifacts (<code>across-core</code>, <code>across-web</code> and <code>across-test</code>) and one bill-of-material pom (<code>standard-module-bom</code>).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">across-core</dt>
<dd>
<p>Supports the configuration of an Across context and provides all necessary infrastructure to define and execute modules.</p>
</dd>
<dt class="hdlist1">across-web</dt>
<dd>
<p>Provides an <code>AcrossModule</code> that supports configuration of a web application using Across with the Spring <code>DispatcherServlet</code> as the most common scenario.</p>
</dd>
<dt class="hdlist1">across-test</dt>
<dd>
<p>Supports integration testing of your Across modules, both web and non-web related.  Builds on top of <code>spring-test</code>.</p>
</dd>
<dt class="hdlist1">standard-module-bom</dt>
<dd>
<p>BOM pom for creating an Across Standard Module or any module wishing to adhere to the standard module conventions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is also a separate <a href="https://foreach.atlassian.net/wiki/display/AX/Across+Platform">platform-bom</a> project that provides a bill-of-material for applications built on Across and the Across Standard Modules.</p>
</div>
<div class="paragraph">
<div class="title">Common dependencies</div>
<p>Across is directly tied to Spring framework and all artifacts come with a set of curated dependencies.
Across itself uses the <a href="http://platform.spring.io/platform/">Spring IO platform</a> as a basis for all its dependencies.</p>
</div>
<div class="paragraph">
<div class="title">Artifact repositories</div>
<p>All Across related artifacts - both release and snapshot versions - can be fetched from the Foreach Nexus repository.
This also includes the set of <a href="#across-standard-modules">Across Standard Modules</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>
    <span class="tag">&lt;repository&gt;</span>
        <span class="tag">&lt;id&gt;</span>foreach-nexus<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;name&gt;</span>Foreach nexus<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;url&gt;</span>http://repository.foreach.be/nexus/repository/public/<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;/repository&gt;</span>
<span class="tag">&lt;/repositories&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Release versions are also available in Maven Central.</p>
</div>
<h1 id="developing-across-applications" class="sect0"><a class="anchor" href="#developing-across-applications"></a>Developing Across applications</h1>
<div class="paragraph">
<p>Across Core is the main dependency that is required for bootstrapping an <code>AcrossContext</code>.
If you want to use <code>@AcrossApplication</code> however, you should use <strong>across-web</strong> instead.</p>
</div>
<h2 id="_artifact" class="discrete">Artifact</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>com.foreach.across<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>across-core<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
           <span class="tag">&lt;groupId&gt;</span>com.foreach.across<span class="tag">&lt;/groupId&gt;</span>
           <span class="tag">&lt;artifactId&gt;</span>across-web<span class="tag">&lt;/artifactId&gt;</span>
           <span class="tag">&lt;version&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/version&gt;</span>
       <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_across_application"><a class="anchor" href="#_creating_an_across_application"></a>1. Creating an Across application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usually an Across application is created for a web scenario and <code>@AcrossApplication</code>.
This configures your application and starts it up as a Spring Boot application.</p>
</div>
<div class="paragraph">
<p>Behind the scenes, <code>@AcrossApplication</code> uses <code>@EnableAcrossContext</code>.
The latter can also be used for defining an Across context on a configuration class, but without the Spring Boot application support.</p>
</div>
<div class="sect2">
<h3 id="enableacrosscontext"><a class="anchor" href="#enableacrosscontext"></a>1.1. @EnableAcrossContext</h3>
<div class="paragraph">
<p>Usually your application will consist of a single <code>AcrossContext</code> that is configured in the main Spring <code>ApplicationContext</code>.
You can enable the automatic creation of an <code>AcrossContext</code> by putting the <code>@EnableAcrossContext</code> on any <code>@Configuration</code> class.
This will initialize a new <code>AcrossContext</code> with the main <code>ApplicationContext</code> as parent, look for a <a href="#across-datasource">default datasource bean</a> named <strong>acrossDataSource</strong> and then configure modules based on the <code>@EnableAcrossContext</code> attribute values.</p>
</div>
<div class="sect3">
<h4 id="_acrosscontext_autoconfiguration"><a class="anchor" href="#_acrosscontext_autoconfiguration"></a>1.1.1. AcrossContext autoconfiguration</h4>
<div class="paragraph">
<p>By default autoconfiguration of the <code>AcrossContext</code> will be enabled.
This implies that all <code>AcrossModule</code> beans from the parent <code>ApplicationContext</code> will be configured, along with any modules specified by name on <code>@EnableAcrossContext</code>.</p>
</div>
<div class="paragraph">
<p>When autoconfiguration is enabled, packages will be scanned to find valid module classes.
Unless packages are configured manually using the <strong>modulePackages</strong> or <strong>modulePackageClasses</strong> attributes, the <em>com.foreach.across.modules</em> package along with the package of the declaring <code>@Configuration</code> class will be scanned.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you use <code>@EnableAcrossContext</code> on a top-level class (no package specified), package <em>modules</em> and <em>com.foreach.across.modules</em> will be used for default scanning.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Scanning for modules in itself does not add any modules to the <code>AcrossContext</code>.
It simply maps all modules that could be autoconfigured on their unique name.
For a module to be autoconfigurable it should adhere to certain conventions, see the section on <a href="#creating-an-acrossmodule">creating an Across module</a> for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The module scanning packages and settings can be controlled through attributes on <code>@EnableAcrossContext</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
A module name should be unique.
If you have more than one module with the same name, the last module scanned will take precedence.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Minimal example of using @EnableAcrossContext</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Minimal configuration that will attempt to resolve module MyCustomModule:
 * - in the standard modules package (com.foreach.across.modules)
 * - in the package that AppConfiguration belongs to
 *
 * If found, MyCustomModule and its required dependencies will be added to the AcrossContext.
 * If not found, AcrossContext bootstrapping will fail.
 */</span>
<span class="annotation">@Configuration</span>
<span class="annotation">@EnableAcrossContext</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">MyCustomModule</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfiguration</span>
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to customize the module configuration or a module is not autoconfigurable, you can add it as a bean in the parent <code>ApplicationContext</code> instead.</p>
</div>
<div class="listingblock">
<div class="title">Example adding a module as a bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * AcrossWebModule is added to the AcrossContext by name.
 *
 * MyCustomModule is added as a bean in the ApplicationContext.
 * Because the bean implements AcrossModule, it will also be added to the AcrossContext.
 *
 * All required dependencies of either module will also be added if they can be found through scanning.
 */</span>
<span class="annotation">@Configuration</span>
<span class="annotation">@EnableAcrossContext</span>( AcrossWebModule.NAME )
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfiguration</span>
{
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> MyCustomModule myCustomModule() {
        <span class="keyword">return</span> <span class="keyword">new</span> MyCustomModule();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the previous example shows, you can safely combine beans and named module configuration.
Modules are configured in a certain order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modules defined by name on <code>@EnableAcrossContext</code></p>
</li>
<li>
<p>Module beans detected in the <code>ApplicationContext</code></p>
</li>
<li>
<p>Modules added through <a href="#acrosscontextconfigurer"><code>AcrossContextConfigurer</code> instances</a></p>
</li>
<li>
<p>Missing module dependencies resolved during bootstrap</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a module with the same name gets added more than once, the last version added will always win.</p>
</div>
</div>
<div class="sect3">
<h4 id="acrosscontextconfigurer"><a class="anchor" href="#acrosscontextconfigurer"></a>1.1.2. Customizing the AcrossContext</h4>
<div class="paragraph">
<p>After initial configuration but before bootstrapping, the configured <code>AcrossContext</code> will be delegated to all <code>AcrossContextConfigurer</code> beans it can find in the <code>ApplicationContext</code>.
This allows for changing any settings before the actual bootstrap happens.</p>
</div>
<div class="listingblock">
<div class="title">Example customizing an AcrossContext</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAcrossContext</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfiguration</span> <span class="directive">implements</span> AcrossContextConfigurer
{
        <span class="annotation">@Bean</span>
        <span class="directive">public</span> <span class="predefined-type">DataSource</span> acrossDataSource() {
                BasicDataSource dataSource = <span class="keyword">new</span> BasicDataSource();
                dataSource.setDriverClassName( <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbc.JDBCDriver</span><span class="delimiter">&quot;</span></span> );
                dataSource.setUrl( <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:mem:/hsql/testDataSource</span><span class="delimiter">&quot;</span></span> );
                dataSource.setUsername( <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span> );
                dataSource.setPassword( <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> );

                <span class="keyword">return</span> dataSource;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> configure( AcrossContext context ) {
                context.setDevelopmentMode( <span class="predefined-constant">true</span> );

                context.addModule( <span class="keyword">new</span> SomeModule() );
        }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="across-application"><a class="anchor" href="#across-application"></a>1.2. @AcrossApplication</h3>
<div class="paragraph">
<p><code>@AcrossApplication</code> annotation can be used as an alternative for <code>@EnableAcrossContext</code> and <code>@SpringBootApplication</code> when defining an application.
In addition to default context configuration options, it also adds selected <a href="#spring-boot-autoconfigure">Spring Boot autoconfiguration classes</a> and enables <a href="#dynamic-across-modules">dynamic modules</a>.</p>
</div>
<div class="paragraph">
<p>Using <code>@AcrossApplication</code> is probably the easiest way to setup a simple (Spring Boot based) application backed by an AcrossContext.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using <code>@EnableAutoConfiguration</code> and Spring Boot starters directly with Across is currently not supported.
Only a selected number of starters have support directly built into Across.
See <a href="#across-spring-boot">[across-spring-boot]</a> for more background information.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="embedded-servlet-container"><a class="anchor" href="#embedded-servlet-container"></a>1.2.1. Embedded servlet container</h4>
<div class="paragraph">
<p>Using <code>@AcrossApplication</code> adds the necessary Spring Boot auto configuration classes for embedded servlet containers.
If you have for example <strong>spring-boot-starter-tomcat</strong> on the classpath, you can run an Across based application inside an embedded Tomcat using <code>SpringApplication</code>.</p>
</div>
<div class="listingblock">
<div class="title">Minimal example of a Spring Boot based Across application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AcrossApplication</span>(modules = { MyModule.NAME, MyOtherModule.NAME })
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span>
{
        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) {
                SpringApplication.run( MyApplication.class, args );
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-across-modules"><a class="anchor" href="#dynamic-across-modules"></a>1.2.2. Dynamic Across modules</h4>
<div class="paragraph">
<p>Using <code>@AcrossApplication</code> on a class will automatically enable dynamic Across modules on that class.
Before bootstrapping the context, the configurator will attempt to find an application specific infrastructure, application or postprocessor module.
The name of the expected module is generated based on the name of the importing class.
If no module with that name can be resolved, the configurator will see if a child package is present relative to the package of the importing class.
Depending on the child package name, a dynamic module will be generated.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Importing class</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyApplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyConfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure module</strong><br>
package: <em>infrastructure</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyApplicationInfrastructureModule<br>
resources: myApplicationInfrastructure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyConfigurationInfrastructureModule<br>
resources: myConfigurationInfrastructure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Application module</strong><br>
package: <em>application</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyApplicationModule<br>
resources: <strong>my</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyConfigurationApplicationModule<br>
resources: <strong>myConfiguration</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PostProcessor module</strong><br>
package: <em>postprocessor</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyApplicationPostProcessorModule<br>
resources: myApplicationPostProcessor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyConfigurationPostProcessorModule<br>
resources: myConfigurationPostProcessor</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example package structure for application modules</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">com.mypackage
  MyApplication.class
  application.config
    MyApplicationModuleConfiguration.class
  infrastructure.installers
    SchemaInstallerToRunBeforeAnyOtherModule.class</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disabling dynamic modules on an <code>@AcrossApplication</code> can be done through the <strong>enableDynamicModules</strong> attribute.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Dynamic modules perform an automatic component scan of all their child packages with the exception of <em>installers</em> and <em>extensions</em>.
If you want the default behavior of scanning only the <em>config</em> child package, you must provide an <code>AcrossModule</code> implementation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want to manually add dynamic modules, please see the javadoc for <code>AcrossDynamicModulesConfigurer</code> and <code>AcrossDynamicModulesConfiguration</code>.
</td>
</tr>
</table>
</div>
<h3 id="_manual_configuration" class="discrete">Manual configuration</h3>
<div class="paragraph">
<p>An <code>AcrossContext</code> can be also configured manually and is started using the <code>bootstrap()</code> method, and stopped using <code>shutdown()</code>.
These methods take care of the Spring <code>ApplicationContext</code> lifecycle of all modules configured in the context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AcrossContext context = <span class="keyword">new</span> AcrossContext();
context.setParentApplicationContext( optionalParentContext );
context.setDataSource( someDataSource );
context.addModule( <span class="keyword">new</span> SomeModule() );

<span class="comment">// Start the context</span>
context.bootstrap();

<span class="comment">// Stop the context</span>
context.shutdown();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_configuration"><a class="anchor" href="#_module_configuration"></a>2. Module configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apart from module settings, an application can also define a number of <code><a href="#moduleconfiguration">@ModuleConfiguration</a></code> classes to be added to the bootstrapping modules.
When using the <code>@EnableAcrossContext</code>, the packages to scan for these can be set using attributes, but by default the sub-packages <strong>config</strong> and <strong>extensions</strong> of the importing class will be used.</p>
</div>
<div class="paragraph">
<p>Alternatively the packages to scan can be controlled via the <code>moduleConfigurationScanPackages</code> property on <code>AcrossContext</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="across-bootstrap"><a class="anchor" href="#across-bootstrap"></a>3. Across bootstrap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Across bootstrap is the actual starting of the application.
During the bootstrapping phase the entire Spring <code>ApplicationContext</code> hierarchy of an application is created.</p>
</div>
<div class="paragraph">
<p>A typical Across application has the following bootstrap phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The root <code>ApplicationContext</code> is scanned, which includes the configuration of the Across context (represented by the <code>@AcrossApplication</code> annotation).</p>
</li>
<li>
<p>The <code>AcrossContext</code> bean is created as early as possible:</p>
<div class="ulist">
<ul>
<li>
<p>the Across context configuration is analyzed and the modules are ordered according to their dependencies;</p>
</li>
<li>
<p>the different module descriptors are offered a chance to customize the Across context configuration;</p>
</li>
<li>
<p>the parent Across <code>ApplicationContext</code> is created to serve as parent for the <code>ApplicationContext</code> of individual modules;</p>
</li>
<li>
<p>every module creates its own <code>ApplicationContext</code> in the order assigned by the Across context;</p>
</li>
<li>
<p>exposed beans are pushed up the <code>ApplicationContext</code> hierarchy as far as possible.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other beans in the root <code>ApplicationContext</code> are created; these can optionally use exposed components from the Across modules.</p>
</li>
<li>
<p>The root <code>ApplicationContext</code> returns and is ready to be used. In case of a Spring Boot application, the Spring <code>ApplicationReadyEvent</code> gets published.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="across-bootstrap-order"><a class="anchor" href="#across-bootstrap-order"></a>3.1. Module bootstrap order</h3>
<div class="paragraph">
<p>During bootstrap the Across context will inspect the dependencies between modules, and will determine the order in which modules should be started.
Once the order has been determined, the modules will be started one by one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installers_2"><a class="anchor" href="#_installers_2"></a>3.2. Installers</h3>
<div class="paragraph">
<p>At several points during bootstrap of an Across context, <a href="#installer-bootstrap-phases">installers can get executed</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bootstrap_events"><a class="anchor" href="#_bootstrap_events"></a>3.3. Bootstrap events</h3>
<div class="paragraph">
<p>During bootstrap, the Across context <a href="#bootstrap-events">publishes several events</a> that allow other components to act upon.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_properties"><a class="anchor" href="#_properties"></a>4. Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both AcrossModule and AcrossContext have a collection of Properties.
These can be accessed directly from the instance, but will also be registered as <code>PropertySource</code> in the bootstrapping <code>ApplicationContext</code>.
Across favours the PropertySource/Environment approach over the concept of multiple PropertyPlaceholderConfigurer.
Reasoning behind this is <a href="https://jira.spring.io/browse/SPR-8539?focusedCommentId=75569&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-75569">explained here as a comment on a Spring issue</a>.</p>
</div>
<h3 id="_registering_additional_propertysources" class="discrete">Registering additional PropertySources</h3>
<div class="paragraph">
<p>Apart from the Properties directly on AcrossModule and AcrossContext instances, there are methods to register additional PropertySources to a module or context.
PropertySources or properties configured on a module, will only be available within that module; whereas PropertySources or properties on the context will be available in all modules.
Because PropertySource is most often based on an actual Resource file, the addPropertySources() methods allow direct usage of Resource instances.
If the Resource does not exist, it is simply ignored.</p>
</div>
<h3 id="_propertysource_priority" class="discrete">PropertySource priority</h3>
<div class="paragraph">
<p>Within the context or module, the order in which PropertySources have been registered determines the order of looking for the property values.
In a context/module hierarchy, the following order is used:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>properties set directly on the current AcrossModule</p>
</li>
<li>
<p>PropertySources attached to the current AcrossModule (last one added first)</p>
</li>
<li>
<p>properties set directly on the AcrossContext</p>
</li>
<li>
<p>PropertySources attached to the AcrossContext (last one added first)</p>
</li>
<li>
<p>PropertySources registered in the parent ApplicationContext</p>
</li>
</ol>
</div>
<h3 id="_accessing_properties_in_modules" class="discrete">Accessing properties in modules</h3>
<div class="paragraph">
<p>Accessing properties in modules is no different than in standard Spring.
By default all properties can be accessed using the Environment.</p>
</div>
<div class="listingblock">
<div class="title">Example using Environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span>
{
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AcrossContext acrossContext( ConfigurableApplicationContext applicationContext ) <span class="directive">throws</span> <span class="exception">Exception</span> {
        AcrossContext context = <span class="keyword">new</span> AcrossContext( applicationContext );
        context.setDataSource( acrossDataSource() );
        context.setAllowInstallers( <span class="predefined-constant">true</span> );

        <span class="comment">// Configure some properties</span>
        context.setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">directProperty</span><span class="delimiter">&quot;</span></span>, <span class="integer">789</span> );
        context.addPropertySources( <span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.properties</span><span class="delimiter">&quot;</span></span>) );

        context.addModule( testModule1() );
        context.addModule( testModule2() );
        <span class="keyword">return</span> context;
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfigInModule</span>{
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> Environment environment;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> MyBean myBean() {
        <span class="keyword">return</span> <span class="keyword">new</span> MyBean( environment.getProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">my.property</span><span class="delimiter">&quot;</span></span> ) );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use placeholders you must add a PropertySourcesPlaceholderConfigurer to every module where you want placeholders to be resolved.
Because of the way BeanFactoryPostProcessors and PropertyPlaceholderConfigurers work, it is best to configure a new instance in every module, instead of passing a shared postprocessor to all modules.
A default ApplicationContextConfigurer is available in the PropertyPlaceholderSupportConfigurer class.
In practice however: it should be the responsibility of the module to configure a PropertyPlaceholderConfigurer if it uses placeholders!</p>
</div>
<div class="listingblock">
<div class="title">Example using PropertySources and simple property placeholder resolving</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span>
{
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AcrossContext acrossContext( ConfigurableApplicationContext applicationContext ) <span class="directive">throws</span> <span class="exception">Exception</span> {
        AcrossContext context = <span class="keyword">new</span> AcrossContext( applicationContext );
        context.setDataSource( acrossDataSource() );
        context.setAllowInstallers( <span class="predefined-constant">true</span> );

        <span class="comment">// Configure some properties</span>
        context.setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">directProperty</span><span class="delimiter">&quot;</span></span>, <span class="integer">789</span> );
        context.addPropertySources( <span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.properties</span><span class="delimiter">&quot;</span></span>) );

        <span class="comment">// Register the property placeholder resolving in every module</span>
        context.addApplicationContextConfigurer( <span class="keyword">new</span> PropertyPlaceholderSupportConfigurer(),
                                                 ConfigurerScope.CONTEXT_AND_MODULES );

        context.addModule( testModule1() );
        context.addModule( testModule2() );
        <span class="keyword">return</span> context;
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfigInModule</span> {
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> MyBean myBean( <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${my.property}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> myProperty ) {
        <span class="keyword">return</span> <span class="keyword">new</span> MyBean( environment.getProperty( myProperty  ) );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example using custom property placeholder resolving</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Import inner class to make resolver available both in parent as in Across context</span>
<span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>(CustomPropertyConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span>
{
    <span class="annotation">@Configuration</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CustomPropertyConfig</span>
    {
        <span class="annotation">@Bean</span>
        <span class="directive">public</span> <span class="directive">static</span> PropertySourcesPlaceholderConfigurer properties() {
            PropertySourcesPlaceholderConfigurer configurer = <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();
            configurer.setLocation( <span class="keyword">new</span> ClassPathResource( <span class="string"><span class="delimiter">&quot;</span><span class="content">my.properties</span><span class="delimiter">&quot;</span></span> ) );
            <span class="keyword">return</span> configurer;
        }
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AcrossContext acrossContext( ConfigurableApplicationContext applicationContext ) <span class="directive">throws</span> <span class="exception">Exception</span> {
        AcrossContext context = <span class="keyword">new</span> AcrossContext( applicationContext );
        context.setDataSource( acrossDataSource() );
        context.setAllowInstallers( <span class="predefined-constant">true</span> );

        <span class="comment">// Register the property placeholder resolving in every module</span>
        context.addApplicationContextConfigurer( <span class="keyword">new</span> AnnotatedClassConfigurer( CustomPropertyConfig.class ),
                                                 ConfigurerScope.CONTEXT_AND_MODULES );


        context.addModule( testModule1() );
        context.addModule( testModule2() );
        <span class="keyword">return</span> context;
    }
}

<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeBeanInModule</span> {
    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${my.property}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> someValueFromProperty;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="across-datasource"><a class="anchor" href="#across-datasource"></a>5. Across datasource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Across context supports the configuration of a <code>DataSource</code> instance.
If there is a primary <code>DataSource</code> or only a single <code>DataSource</code> bean available, Across will automatically use that one.</p>
</div>
<div class="paragraph">
<p>The datasource will be available for all modules as bean named <strong>acrossDataSource</strong>.
Additionally a second datasource can be configured that will be available as the <strong>acrossInstallerDataSource</strong>.
If no separate installer datasource is specified, the default across datasource will be used.</p>
</div>
<div class="paragraph">
<div class="title">Installers</div>
<p>Across only actually needs a datasource if you want to execute installers or use the <code>DistributedLockRepository</code> directly.
The datasource is used for keeping track of which installers have been executed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events"><a class="anchor" href="#events"></a>6. Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every Across context creates an <code>AcrossEventPublisher</code> bean.
This bean can be wired in any module to dispatch events.
The default implementation of the event publisher uses MBassador.</p>
</div>
<h3 id="_publishing_events" class="discrete">Publishing events</h3>
<div class="paragraph">
<p>Publishing an event can be done from anywhere by simply creating an instance of the AcrossEvent interface.
This is a marker interface not defining any additional methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SomeEvent</span> <span class="directive">implements</span> AcrossEvent {
}

<span class="annotation">@Autowired</span>
<span class="directive">private</span> AcrossEventPublisher eventBus;

<span class="directive">public</span> <span class="type">void</span> sendEvent() {
  eventBus.publish( <span class="keyword">new</span> SomeEvent() );
}</code></pre>
</div>
</div>
<h3 id="_subscribing_to_events" class="discrete">Subscribing to events</h3>
<div class="paragraph">
<p>Event handlers must not implement any special interface, event handler methods must declare themselves as handling an event by specifying the @Event annotation.
A single object can have many handler methods.
All beans created in the <code>ApplicationContext</code> are automatically scanned for event handler methods.</p>
</div>
<div class="listingblock">
<div class="title">Example component with an event handling method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyHandler</span> {
    <span class="annotation">@Event</span>
    <span class="directive">public</span> <span class="type">void</span> handle( SomeEvent event ) {
        <span class="comment">// Called whenever an event of type SomeEvent is published</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Take special care when combining AOP with event handlers, as the event publisher only has limited support for AOP proxies.
Depending on the strategy used (CGlib or JDK proxy) the actual proxy (CGlib) or the proxy target (in case of JDK proxy) will be registered as the event handler.
In the latter case the event will still be fired but the actual handle method will not be intercepted.
</td>
</tr>
</table>
</div>
<h4 id="_manual_subscription" class="discrete">Manual subscription</h4>
<div class="paragraph">
<p>Any object can register itself as listener by subscribing to the <code>AcrossEventPublisher</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of a non-managed object manually subscribing to the AcrossEventPublisher</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> AcrossEventPublisher eventBus;

<span class="directive">public</span> <span class="type">void</span> startListening() {
    <span class="comment">// Subscribe ourselves to the event bus</span>
    eventBus.subscribe( <span class="local-variable">this</span> );
}

<span class="directive">public</span> <span class="type">void</span> stopListening() {
    <span class="comment">// Remove ourselves from the event bus</span>
    eventBus.unsubscribe( <span class="local-variable">this</span> );
}

<span class="annotation">@Event</span>
<span class="directive">public</span> <span class="type">void</span> handle( SomeEvent event ) {
    <span class="comment">// Called whenever an event of type SomeEvent is published</span>
}</code></pre>
</div>
</div>
<h3 id="_filtering_events" class="discrete">Filtering events</h3>
<div class="paragraph">
<p>Depending on the interface an event implements a handler can be specific about which events it wants to receive.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event implements</th>
<th class="tableblock halign-left valign-top">Filtering</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AcrossEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is only done on the class of the event. All instances of the specific event class (or subclasses) will be handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NamedAcrossEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is done on the class of the event as well as the name of the event if an @EventName annotation is present on the handler method.
WARNING: If the handler method defines an @EventName only events matching one of the names and implementing NamedAcrossEvent will be handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ParameterizedAcrossEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is done on the class of the event as well as on the defined generic parameters.
All instances matching the specific event class and the specific generic class (or subclasses) will be handled.
To support complex generic type filtering, implementations must specify their generic parameters as Spring ResolvableType instances.
Multiple generic parameters as well as nested generics are supported.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Filters can be combined: it is possible to filter an event on both event name and generic parameter.
An event must pass all filters before it is handled.</p>
</div>
<div class="listingblock">
<div class="title">Examples of custom events</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Named events.
 */</span>
<span class="type">class</span> <span class="class">MyNamedEvent</span> <span class="directive">implements</span> NamedAcrossEvent {
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="predefined-type">String</span> getEventName() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">MyNamedEvent</span><span class="delimiter">&quot;</span></span>;
  }
}

<span class="annotation">@Event</span>
<span class="directive">public</span> <span class="type">void</span> handle( <span class="annotation">@EventName</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">MyNamedEvent</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">MyOtherNamedEvent</span><span class="delimiter">&quot;</span></span>}) NamedAcrossEvent event ) {
    <span class="comment">// do something</span>
}

<span class="comment">/**
 * Event with generic parameters.
 */</span>
<span class="type">class</span> <span class="class">MyListEvent</span>&lt;T&gt; <span class="directive">implements</span> ParameterizedAcrossEvent {
  <span class="directive">private</span> <span class="directive">final</span> ResolvableType<span class="type">[]</span> genericTypes;


  <span class="directive">public</span> MyListEvent( <span class="predefined-type">Class</span> memberClass ) {
    genericTypes = <span class="keyword">new</span> ResolvableType<span class="type">[]</span> {
      ResolvableType.forClassWithGenerics( <span class="predefined-type">List</span>.class, memberClass )
    };
  }


  <span class="annotation">@Override</span>
  <span class="directive">public</span> ResolvableType<span class="type">[]</span> getEventGenericTypes() {
    <span class="keyword">return</span> genericTypes;
  }
}

<span class="annotation">@Event</span>
<span class="directive">public</span> <span class="type">void</span> handle( MyListEvent&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; event ) {
  <span class="comment">// would match against: new MyListEvent&lt;List&lt;Integer&gt;&gt;( Integer.class );</span>
}</code></pre>
</div>
</div>
<h3 id="bootstrap-events" class="discrete">Bootstrap events</h3>
<div class="paragraph">
<p>The following bootstrap events are being published by the AcrossContext:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AcrossModuleBeforeBootstrapEvent</dt>
<dd>
<p>Sent for each module, right before the bootstrapping of that module starts.
This is the very last point in time in which the ModuleBootstrapConfig can still be modified.</p>
</dd>
<dt class="hdlist1">AcrossModuleBootstrappedEvent</dt>
<dd>
<p>Sent for each module, right after the module has bootstrapped.</p>
</dd>
<dt class="hdlist1">AcrossContextBootstrappedEvent</dt>
<dd>
<p>Sent once for every AcrossContext, after the entire bootstrap phase has finished.</p>
</dd>
</dl>
</div>
<h3 id="_exceptions_in_events" class="discrete">Exceptions in events</h3>
<div class="paragraph">
<p>When dispatching an event through its handlers, each handler is executed in isolation from the others.
Events do not bubble up to the publisher.
This means if an exception occurs within a handler, that will not impact the original publisher in anyway and the next handler will simply execute.
However, when an exception occurs that is not handled within the handler method, a new <code>PublicationError</code> message is publishes that can be picked up with a custom <code>IPublicationErrorHandler</code> implementation added to the underlying <code>MBassadorEventPublisher</code> using <code>addErrorHandler()</code>.
By default all exceptions will be logged in the <code>AcrossEventPublisher</code> logger.</p>
</div>
<h3 id="event-handler-ordering" class="discrete">Event handler ordering</h3>
<div class="paragraph">
<p>Event handlers can be ordered, although the support is limited.
Events are handled in module bootstrap order, with handlers from the same AcrossModule having a random order.
You can force an event handler order by assigning an <code>@Order</code> or <code>@OrderInModule</code> annotation on either the bean that declares the handler method, or on the handler method itself.</p>
</div>
<div class="paragraph">
<p>The default ordering should be sufficient for most use cases: you can rely on event handlers from previous modules having been executed.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Ordering event handlers is only supported on a class-level.
This is a limitation of the current implementation.
This means that multiple beans from the same class will get the same order assigned!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="refreshing"><a class="anchor" href="#refreshing"></a>7. Refreshing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AcrossContext is refreshed once, right before it is fully bootstrapped.
Refresh happens after all individual modules have bootstrapped and all beans have been exposed, but before the after-bootstrap installers have run.</p>
</div>
<div class="paragraph">
<p>There are several ways to hook into the refresh phase:</p>
</div>
<div class="sect2">
<h3 id="__refreshable"><a class="anchor" href="#__refreshable"></a>7.1. @Refreshable</h3>
<div class="paragraph">
<p>Any bean annotated with <code>@Refreshable</code> will be autowired twice.
Once when it gets created, and once when the AcrossContext is refreshed.
You can use this for optional dependencies where the value might be exposed by a later module.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Although the functionality is there, you should probably avoid using <code>@Refreshable</code> and prefer <code>@PostRefresh</code> or subscribing to one of the bootstrap related events.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="__postrefresh"><a class="anchor" href="#__postrefresh"></a>7.2. @PostRefresh</h3>
<div class="paragraph">
<p>Much like <code>@PostConstruct</code>, a bean can have one or more <code>@PostRefresh</code> methods.
These will be executed when the AcrossContext is refreshed.</p>
</div>
</div>
<div class="sect2">
<h3 id="__refreshablecollection"><a class="anchor" href="#__refreshablecollection"></a>7.3. @RefreshableCollection</h3>
<div class="paragraph">
<p><code>@RefreshableCollection</code> is an annotation to qualify dependencies being autowired.
It can only be used on dependencies of type <code>Collection</code>.</p>
</div>
<div class="paragraph">
<p>When using <code>@RefreshableCollection</code>, instead of a regular collection of beans, a <code><a href="#RefreshableRegistry">RefreshableRegistry</a></code> will be wired.
The behaviour and type of the <code>RefreshableRegistry</code> can be determined through the annotation attributes.</p>
</div>
<div class="listingblock">
<div class="title">Example autowiring collection that will contain all MyBean instances from all modules, even if not exposed</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> setMyBeans( <span class="annotation">@RefreshableCollection</span>(includeModuleInternals=<span class="predefined-constant">true</span>) <span class="predefined-type">Collection</span>&lt;MyBean&gt; myBeans ) {
    <span class="local-variable">this</span>.myBeans = myBeans;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="RefreshableRegistry"><a class="anchor" href="#RefreshableRegistry"></a>7.4. RefreshableRegistry</h3>
<div class="paragraph">
<p>A <code>RefreshableRegistry</code> is a collection of beans of a specified class that updates itself once when the AcrossContext is refreshed.
A <code>RefreshableRegistry</code> can also scan for beans inside the other modules in the running context, without the need for those beans to be exposed.
This allows other modules to pick up extensions or configurations from other modules that bootstrap later.</p>
</div>
<div class="paragraph">
<p>The value of a <code>RefreshableRegistry</code> are also ordered according to the <a href="#ordering-beans">Across module order hierarchy</a>.</p>
</div>
<div class="paragraph">
<p><code>IncrementalRefreshableRegistry</code> is a specialization that updates its values every time a module has bootstrapped.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ordering-beans"><a class="anchor" href="#ordering-beans"></a>8. Bean order</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In an Across based application, the primary order of bean interaction should be defined by the module dependencies.
When scanning for beans in all modules (eg. when using a <code>RefreshableRegistry</code> or <code>@RefreshableCollection</code>), the beans will be returned according to the module order: beans from earlier bootstrapped modules will be before beans from later modules.
The reasoning is simple: <em>if I depend on module A, i can rely on module A having done its things before I will</em>.
If you need more sophisticated ordering, there are two extension points to the default behavior:</p>
</div>
<div class="paragraph">
<div class="title">Order annotation and Ordered interface</div>
<p>Core Spring classes.
If you define these on beans, these will take precedence over the order of the modules themselves.
The <code>Ordered</code> interface takes precedence over an <code>@Order</code> annotation, if both are present.
Using global ordering should be avoided as much as possible, but using for example <code>Ordered.LOWEST_PRECEDENCE</code> you can ensure that a bean comes after all other context created beans in the list.</p>
</div>
<div class="paragraph">
<div class="title">OrderInModule annotation and OrderedInModule interface</div>
<p>The equivalent of <code>@Order</code> and <code>Ordered</code>, but they only apply within a single module.
Use these if you have multiple beans (eg security configurers) of the same type in a single module, and it is important they follow a sequence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unless a specific order is given either through the interface or annotation, a default order of <code>Ordered.LOWEST_PRECEDENCE - 1000</code> is applied.
This way you can still force beans to be ordered behind beans without an explicit order.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The current version of Across does not apply the module order hierarchy to event handlers.
If event handlers need an order, it should be defined explicitly and you cannot rely that event handlers from other modules you depend on will have been executed before you.
This is an important work in progress for one of the next versions of Across.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conversionservice"><a class="anchor" href="#_conversionservice"></a>9. ConversionService</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An AcrossContext requires a valid <code>ConversionService</code> bean named <strong>conversionService</strong> to be present.
If there is none, a <code>DefaultFormattingConversionService</code> will be created and exposed.
If you want to manage the <code>ConversionService</code> yourself, simply create a <code>ConversionService</code> with the right name in the parent <code>ApplicationContext</code>.</p>
</div>
<div class="paragraph">
<p>The default <strong>conversionService</strong> will also be attached to the <code>ApplicationContext</code> environment of every module.
This means property fetching using <code>Environment.getProperty()</code> methods will perform type conversion using the <code>ConversionService</code> (eg. useful for date property parsing).</p>
</div>
<div class="paragraph">
<div class="title">Date conversion</div>
<p>Apart from the <code>ConversionService</code> itself, an <code>AcrossContext</code> creates a default <code>StringToDateConverter</code> bean named <strong>defaultDateConverter</strong>.
This converter supports converting a string to a corresponding date in many common date patterns.
The <code>StringToDateConverter</code> assumes a fixed locale that can be configured (default: <code>US</code>).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you manage the <code>ConversionService</code> outside of the <code>AcrossContext</code> the default <code>StringToDateConverter</code> will not be registered either.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="development-mode"><a class="anchor" href="#development-mode"></a>10. Development mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AcrossContext can have development mode enabled through the <strong>developmentMode</strong> property.
Modules can use development mode to configure different services (or services differently).
An example is auto-reloading and no caching of the message sources if development mode is active.</p>
</div>
<div class="paragraph">
<p>Apart from setting the <strong>developmentMode</strong> property on <code>AcrossContext</code>, development mode can be activated the following way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>property <strong>across.development.active</strong> is <em>true</em></p>
</li>
<li>
<p>Spring profile <strong>dev</strong> is active</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Resource resolving</div>
<p>By default resources (eg. messages, templates) are resolved from the classpath.
It is possible to configure a physical location for the resources of a module if development mode is active (eg on your local filesystem).</p>
</div>
<div class="paragraph">
<p><em>Default location</em><br>
For simple Across based applications using <code>@AcrossApplication</code> it might be enough to simply activate development mode.
If the working directory of the running application contains a <strong>src/main/resources</strong> directory, this directory would be used for all dynamic modules, unless a specific value is set.
This would usually be the case for single maven module projects.</p>
</div>
<div class="paragraph">
<p><em>Specific module resource locations</em><br>
The path can be configured by adding the right property to the application properties, or specifying them in the development mode properties.
The development mode properties is a special properties file that by default will be looked for in <strong>${user.home}/dev-configs/across-devel.properties</strong>.</p>
</div>
<div class="paragraph">
<p>A resource location for the development mode properties can be specified by setting the <strong>across.development.properties</strong> property value.
Development mode properties are loaded using resource resolving, so classpath resources can be used as well (eg. <em>classpath:/dev.properties</em>).</p>
</div>
<div class="paragraph">
<p>The development mode properties file should contain properties where the key references the module name, and the value the physical resources directory.</p>
</div>
<div class="listingblock">
<div class="title">Example development properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># Absolute directory
acrossModule.MyModule.resources=c:/code/mymodule/src/main/resources
acrossModule.OtherModule.resources=c:/code/othermodule/src/main/resources

# Relative to the working directory
acrossModule.SomeModule.resources=some-module/src/main/resources</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using relative paths can be an effective way to embed development properties in a multi-module maven project.
Paths should be relative to the working directory of the running application.
Depending on how you run the application, the working directory can differ.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Properties added directly to the application properties will take precedence over those present in the development mode properties.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="developing-across-modules" class="sect0"><a class="anchor" href="#developing-across-modules"></a>Developing Across modules</h1>
<div class="sect1">
<h2 id="creating-an-acrossmodule"><a class="anchor" href="#creating-an-acrossmodule"></a>1. Creating an AcrossModule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating a new Across module is done by extending <code>AcrossModule</code> and providing a valid name and description.
An <code>AcrossModule</code> is in essence a configuration class.
It uniquely identifies the module and holds all configuration parameters required to bootstrap the module.
It also allows you to alter settings of how beans should be shared with other modules.</p>
</div>
<div class="paragraph">
<p>A module name should be unique and as a best practice also be available as a public static final <strong>NAME</strong> field on the <code>AcrossModule</code> implementation.</p>
</div>
<div class="listingblock">
<div class="title">Minimal AcrossModule</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ValidModule</span> <span class="directive">extends</span> AcrossModule
{
        <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">ValidModule</span><span class="delimiter">&quot;</span></span>;

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
                <span class="keyword">return</span> NAME;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">ValidModule exposes some valid beans.</span><span class="delimiter">&quot;</span></span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Making an AcrossModule autoconfigurable</div>
<p>For an Across module to be autoconfigurable it must adhere to the following conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the module name must be available in the public static final <strong>NAME</strong> field</p>
</li>
<li>
<p>the module must have public constructor without any parameters</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Definining beans</div>
<p>Upon bootstrap a module will create its own <code>ApplicationContext</code> with the <code>AcrossContext</code> as parent.
The beans created in the module <code>ApplicationContext</code> are configured using <code>ApplicationContextConfigurer</code> instances.</p>
</div>
<div class="paragraph">
<p>By default a scan for <code>@Configuration</code> classes will happen on the <strong>config</strong> package below the package of the <code>AcrossModule</code> implementation.
If you want more explicit control, you can override the <code>registerDefaultApplicationContextConfigurers()</code> method.</p>
</div>
<div class="paragraph">
<div class="title">Module resources</div>
<p>Most modules will also define one or more resources in a location determined on the <em>resources key</em> of the module.
By default the resources key or a module is the same as the module name.
You can change this by overriding the <code>getResourcesKey()</code> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_dependencies_2"><a class="anchor" href="#_module_dependencies_2"></a>2. Module dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several ways to influence the beans that are being bootstrapped with a module, by passing information from the configuration to the actual module ApplicationContext.</p>
</div>
<div class="sect2">
<h3 id="__acrossdepends"><a class="anchor" href="#__acrossdepends"></a>2.1. @AcrossDepends</h3>
<h4 id="_using_acrossdepends_on_a_module" class="discrete">Using @AcrossDepends on a module</h4>
<div class="paragraph">
<p>Using AcrossDepends annotation on a component class you can avoid beans or Configurations from being created based on the presence of other modules.
required modules: the component will only be created if all required modules are present
optional modules: the component will only be created if at least one of the optional modules is present</p>
</div>
<h4 id="_using_acrossdepends_on_component_classes" class="discrete">Using @AcrossDepends on component classes</h4>
<div class="paragraph">
<p>expression will be evaluated against the module context - as usual - beans from earlier modules will be available</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditionals"><a class="anchor" href="#_conditionals"></a>2.2. Conditionals</h3>
<div class="paragraph">
<p>Any Spring conditional can be used to determine of a bean should be created.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bootstrap_interaction"><a class="anchor" href="#_bootstrap_interaction"></a>3. Bootstrap interaction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="moduleconfiguration"><a class="anchor" href="#moduleconfiguration"></a>3.1. @ModuleConfiguration</h3>
<div class="paragraph">
<p>Any module can provide a number of classes annotated with <code>@ModuleConfiguration</code>.
These classes are just like classes annotated with <code>@Configuration</code>, except they will not be added to the <code>ApplicationContext</code> of the current module, but to the ones of the modules specified in the annotation attributes.</p>
</div>
<div class="paragraph">
<p><code>@ModuleConfiguration</code> serves as a replacement for <code>@Configuration</code>.
All other bean related annotations like conditionals should also work on <code>@ModuleConfiguration</code> classes.
Keep in mind however that the actual creation of the beans (and evaluation of conditionals) will happen in the <code>ApplicationContext</code> to which the configuration is added, and not necessarily the one of the module defining the class.</p>
</div>
<div class="listingblock">
<div class="title">Example of using @ModuleConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ModuleConfiguration</span>(SpringSecurityModule.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SecurityConfiguration</span>
{
        <span class="annotation">@Autowired</span>
        <span class="directive">public</span> <span class="type">void</span> configureGlobal( AuthenticationManagerBuilder auth ) <span class="directive">throws</span> <span class="exception">Exception</span> {
                auth.inMemoryAuthentication()
                    .withUser( <span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> ).password( <span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> )
                    .authorities( <span class="keyword">new</span> NamedGrantedAuthority( <span class="string"><span class="delimiter">&quot;</span><span class="content">access administration</span><span class="delimiter">&quot;</span></span> ) );
        }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When not specifying any module on a <code>@ModuleConfiguration</code>, the configuration will be added to all modules, including the module defining the class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Scanning for <code>@ModuleConfiguration</code> classes</div>
<p>By default the sub-packages <strong>config</strong> and <strong>extensions</strong> of an <code>AcrossModule</code> will be scanned to detect classes annotated with <code>@ModuleConfiguration</code>.
A module can configure these packages by overriding the <code>getModuleConfigurationScanPackages()</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subscribe_to_events"><a class="anchor" href="#_subscribe_to_events"></a>3.2. Subscribe to events</h3>
<div class="paragraph">
<p>A module can interact with the configuration of other modules by subscribing to one of the <a href="#bootstrap-events">bootstrap events</a>.
This can only be done <strong>during</strong> bootstrap.</p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_your_module_descriptor"><a class="anchor" href="#_customizing_your_module_descriptor"></a>3.3. Customizing your module descriptor</h3>
<div class="paragraph">
<p>A third approach for customizing module configuration is implementing <code>prepareForBootstrap()</code> on you <code>AcrossModule</code> module descriptor.
This method is called before the actual bootstrapping of modules happens, which is the last point in time when the configuration of all modules can be modified.</p>
</div>
<div class="listingblock">
<div class="title">Example of a prepareForBootstrap</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> prepareForBootstrap( ModuleBootstrapConfig currentModule, AcrossBootstrapConfig contextConfig ) {
    <span class="keyword">if</span> ( ArrayUtils.contains( supportedViews, AcrossWebViewSupport.JSP ) ) {
        currentModule.addApplicationContextConfigurer(
                <span class="keyword">new</span> AnnotatedClassConfigurer( JstlViewSupportConfiguration.class ) );
    }
    <span class="keyword">if</span> ( ArrayUtils.contains( supportedViews, AcrossWebViewSupport.THYMELEAF ) ) {
        currentModule.addApplicationContextConfigurer(
                <span class="keyword">new</span> AnnotatedClassConfigurer( ThymeleafViewSupportConfiguration.class ) );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-beans"><a class="anchor" href="#exposing-beans"></a>4. Exposing beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A module can share its beans with other modules by <strong>exposing</strong> them.
All exposed beans from a module are pushed upwards into the parent <code>ApplicationContext</code> of the <code>AcrossContext</code> itself.
Likewise, at the end of the context bootstrap, all exposed beans are pushed into the <code>ApplicationContext</code> that is - optionally - configured as the parent of the <code>AcrossContext</code>.</p>
</div>
<div class="paragraph">
<p>Which beans are exposed is determined by the <code>exposeFilter</code> property on an <code>AcrossModule</code>.
By default all beans annotated with <code>@Exposed</code> or <code>@Service</code> will be exposed.
See the <code>com.foreach.across.core.filters.BeanFilter</code> implementations for standard filters.</p>
</div>
<div class="paragraph">
<p>When pushing beans to the parent <code>ApplicationContext</code> it is possible to run into name conflicts or duplicate bean types.
You can use an <code>ExposedBeanDefinitionTransformer</code> to modify the bean definitions that are pushed to the parent.
Common examples for this are changing the bean names or marking the beans as primary.
You can set the transformer to use through the <code>exposeTransformer</code> property on an <code>AcrossModule</code> or the <code>AcrossContext</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ExposedBeanDefinitionTransformer on AcrossModule</dt>
<dd>
<p>will be applied when pushing beans from the module into the <code>AcrossContext</code></p>
</dd>
<dt class="hdlist1">ExposedBeanDefinitionTransformer on AcrossModule</dt>
<dd>
<p>will be applied when pushing beans from the <code>AcrossContext</code> into the parent <code>ApplicationContext</code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeModule</span> <span class="directive">extends</span> AcrossModule
{
        <span class="comment">/**
         * Only expose specific beans from this module and ensure that
         * they have a prefixed bean name for the other modules.
         */</span>
        <span class="directive">public</span> SomeModule() {
                setExposeFilter( <span class="keyword">new</span> ClassBeanFilter( PlatformTransactionManager.class, SessionFactory.class ) );
                setExposeTransformer( <span class="keyword">new</span> BeanPrefixingTransformer( <span class="string"><span class="delimiter">&quot;</span><span class="content">someModule</span><span class="delimiter">&quot;</span></span> ) );
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beans created directly in the <code>AcrossContext</code> scope - and not inside one of the modules - will only be exposed if they are annotated explicitly with <code>@Exposed</code>.
The <code>AcrossContext</code> does not support a custom <code>exposeFilter</code> but you can supply an additional <code>exposeTransformer</code> on the context level.
If you want to avoid an <code>AcrossContext</code> to push the exposed beans further upwards into its parent <code>ApplicationContext</code>, you should configure the <code>ExposedBeanDefinitionTransformer.REMOVE_ALL</code> as <code>exposeTransformer</code> on the <code>AcrossContext</code> itself.
For an <code>AcrossModule</code> using the <code>REMOVE_ALL</code> transformer would be the same as putting <code>null</code> as <code>exposeFilter</code>.</p>
</div>
<div class="paragraph">
<div class="title">Manually exposing beans</div>
<p>In addition to setting the <em>exposeFilter</em> property, <code>AcrossModule</code> has <code>expose(&#8230;&#8203;)</code> methods that allow you to quickly expose one or more beans based on bean name or type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="message-source"><a class="anchor" href="#message-source"></a>5. Message sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="auto-detecting-message-sources"><a class="anchor" href="#auto-detecting-message-sources"></a>5.1. Auto-detecting message sources</h3>
<div class="paragraph">
<p>If a module has a message source packaged in the right location it will be auto-detected and configured.
The following default message properties will be configured automatically if they are present on the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/messages/MODULE_RESOURCES/MODULE_NAME.properties <em>(deprecated)</em></p>
</li>
<li>
<p>/messages/MODULE_RESOURCES/default.properties</p>
</li>
<li>
<p>/messages/MODULE_RESOURCES/default/*.properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default message sources are configured using an instance of <code>AcrossModuleMessageSource</code>.
<code>AcrossModuleMessageSource</code> is a special case of Spring&#8217;s <code>ReloadableResourceBundleMessageSource</code>.
If development mode is active and the development locations for the module have been configured, the classpath lookups are replaced by physical file lookups with a cache time of 1 second.
This is very useful during development where updates to resource bundles can be instantly visible.</p>
</div>
<div class="paragraph">
<p>Automatic configuration of message sources only happens if the module does not define a bean named <strong>messageSource</strong>.
The following section details how you can manually define message sources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_message_source_hierarchy"><a class="anchor" href="#_message_source_hierarchy"></a>5.2. Message source hierarchy</h3>
<div class="paragraph">
<p>Across has its own custom behavior in relation to <strong>messageSource</strong> beans declared in modules.
Each module can declare a default <code>MessageSource</code> bean named <strong>messageSource</strong>.
Upon bootstrap this message source will be added to a hierarchy along with all other <strong>messageSource</strong> beans.
Once bootstrap is complete, a message will be looked up in all sources defined.</p>
</div>
<div class="paragraph">
<div class="title">Default message source hierarchy</div>
<p>By default Across uses the following approach to build a message source hierarchy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>messageSource</strong> bean from a parent <code>ApplicationContext</code> is considered to be application specific and should allow
customizing the messages of the modules</p>
</li>
<li>
<p>a <strong>messageSource</strong> bean in a module is expected to be able to customize messages from other modules that the current
module depends on</p>
<div class="ulist">
<ul>
<li>
<p>this is also interpreted as: the message source of a module takes precedence over the message source of earlier modules</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, once a context is fully bootstrapped and a message is requested, the sources are queried in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>message sources of the parent <code>ApplicationContext</code> (and up its hierarchy if more than one parent)</p>
</li>
<li>
<p>message sources of the modules in reverse bootstrap order (last bootstrapped first)</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Once an <code>AcrossContext</code> is fully bootstrapped, messages will be looked up in the hierarchy built from all bootstrapped modules.
During the bootstrap phase however, only message sources from earlier modules and the parent <code>ApplicationContext</code> are available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Reverting to default spring behavior</div>
<p>Default Spring behavior with message sources is that a <code>MessageSource</code> in an <code>ApplicationContext</code> will get the <code>MessageSource</code> of the parent <code>ApplicationContext</code> as its parent.
In a module setup, this would mean that a message would first be looked up in the source of the module, and only afterwards in the source of the context.
You can force the default behavior to apply by annotating a <strong>messageSource</strong> bean with <code>@Internal</code>.
Note that in that case the <strong>messageSource</strong> will remain internal to the module where it&#8217;s declared.</p>
</div>
<div class="listingblock">
<div class="title">Configuring a custom message source for a module with development mode support</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ModuleConfig</span>
{
        <span class="annotation">@Bean</span>
        <span class="directive">public</span> MessageSource messageSource() {
        AcrossModuleMessageSource source = <span class="keyword">new</span> AcrossModuleMessageSource();
        source.setBasenames( <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/my/module/messages</span><span class="delimiter">&quot;</span></span> );

        <span class="keyword">return</span> source;
        }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installers"><a class="anchor" href="#installers"></a>6. Installers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A module can have one or more installer classes.
The purpose of installers is setup data that modules need, before the actual application takes over.
Examples: creating database schema, installing default or test data&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>An <code>@Installer</code> annotation marks a class as an installer and allows you to specify the important installer attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">attribute</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional (unique) name of the installer.
If not specified, the fully qualified class name of the installer class will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptive text of what will be installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>phase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this installer should run during the context bootstrap.
See <a href="#installer-bootstrap-phases">bootstrap phases</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runCondition</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition when this installer should run.  See <a href="#installer-run-conditions">run conditions</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version number of the installer.
This value should be incremented to enforce a new run of the same installer.
Only relevant if the run condition is <code>VersionDifferent</code>.</p></td>
</tr>
</tbody>
</table>
<h3 id="_installer_detection" class="discrete">Installer detection</h3>
<div class="paragraph">
<p>By default installers are detected from the classpath by scanning the <strong>installers</strong> package relative to the package of the <code>AcrossModule</code>.
Changing the packages to scan for installers can be done by overriding the <code>getInstallerScanPackages()</code> method on <code>AcrossModule</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you manually want to specify a list of installers, you can do so by overriding the <code>getInstallers()</code> method.
Though still possible for compatibility reasons, installers should be specified with their <code>Class</code>.
</td>
</tr>
</table>
</div>
<h3 id="_installer_tracking_and_synchronization" class="discrete">Installer tracking and synchronization</h3>
<div class="paragraph">
<p>The execution of installers is tracked using the <code>AcrossInstallerRepository</code>.
This allows for installers to execute only if they have not yet been executed (see <a href="#installer-run-conditions">run conditions</a>).</p>
</div>
<div class="paragraph">
<p>In addition, installer execution is synchronized for multiple applications connecting on the same database.
This is done through the <code>DistributedLockRepository</code> that is created in the core schema.
A lock will be taken on the database as soon as a single installer wishes to execute, and will be released once that installer has finished executing.</p>
</div>
<div class="paragraph">
<p>The lock owner will contain the hostname of the computer running the application, as well as the <code>displayName</code> of the <code>AcrossContext</code>.</p>
</div>
<div class="paragraph">
<p>Because of tracking and synchronization, a <a href="#installer-datasource">datasource</a> is required in order to execute installers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>AcrossInstallerRepository</code> can be wired as a bean in installers.
This can be helpful in migration trajectories for example to rename installers.
</td>
</tr>
</table>
</div>
<h3 id="installer-bootstrap-phases" class="discrete">Bootstrap phases</h3>
<div class="paragraph">
<p>Installers are executed during a specific phase of the context bootstrap.
This phase should be specified for every installer.
The phase will determine which beans are available in the installer.</p>
</div>
<div class="paragraph">
<p>The following bootstrap phases exist:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BeforeContextBootstrap</dt>
<dd>
<p>The installer is executed before any of the modules in the AcrossContext are bootstrapped.
Only beans from the parent <code>ApplicationContext</code> or the <a href="#installer-applicationcontext">installer <code>ApplicationContext</code></a> are available.</p>
</dd>
<dt class="hdlist1">BeforeModuleBootstrap</dt>
<dd>
<p>The installer is executed before the module that owns it bootstraps, but after all previous modules have bootstrapped.
All beans from previous modules will also be available to the installer.</p>
</dd>
<dt class="hdlist1">AfterModuleBootstrap</dt>
<dd>
<p>The installer is executed after the module that owns it has bootstrapped, but before the next module bootstraps.
All beans from the current module are available.</p>
</dd>
<dt class="hdlist1">AfterContextBootstrap</dt>
<dd>
<p>The installer is executed after all modules have bootstrapped, but before the <code>AcrossContextBootstrappedEvent</code> is published.
All beans from all modules are available.</p>
</dd>
</dl>
</div>
<h3 id="installer-run-conditions" class="discrete">Run conditions</h3>
<div class="paragraph">
<p>The following run conditions are supported for an installer:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AlwaysRun</dt>
<dd>
<p>The installer will always be executed, everytime the module bootstraps.</p>
</dd>
<dt class="hdlist1">VersionDifferent</dt>
<dd>
<p>The installer will only execute if the <em>version</em> attribute is higher than the version previously executed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to the standard run conditions, you can use <a href="#installer-conditionals"><code>@Conditional</code> annotations on installer classes</a>.
This includes for example the use of <code>@AcrossDepends</code> to execute installers if certain modules are active.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using <strong>AlwaysRun</strong> installers will always cause the bootstrap lock to be taken.
 This might cause a slowdown when starting multiple applications on the same datasource simultaneously.
</td>
</tr>
</table>
</div>
<h3 id="_installer_group" class="discrete">Installer group</h3>
<div class="paragraph">
<p>In addition to the standard <code>@Installer</code> attributes, an <code>@InstallerGroup</code> annotation can be specified.
This allows grouping types of installers together (for example schema) and overruling their execution using <a href="#installer-settings"><code>InstallerSettings</code></a>.</p>
</div>
<h3 id="_installer_execution_order" class="discrete">Installer execution order</h3>
<div class="paragraph">
<p>If all conditions are fulfilled, installers will be executed in a predetermined order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in <a href="#installer-bootstrap-phases">bootstrap phase</a> order</p>
</li>
<li>
<p>in <a href="#across-bootstrap-order">module bootstrap order</a></p>
</li>
<li>
<p>in installer order (according to <code>@Order</code> annotations on the installer class)</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Installers without an <code>@Order</code> annotation behave as if they have an order index of <strong>0</strong>.
In that case the installer registration order will be used as a fallback, with installers specified through <code>getInstallers()</code> having a higher precedence.
</td>
</tr>
</table>
</div>
<h3 id="installer-datasource" class="discrete">Datasources and installers</h3>
<div class="paragraph">
<p>An <code>AcrossContext</code> requires at least one datasource if modules need to run installers.
Certain core features like the <code>DistributedLockRepository</code> also require the core schema to be installed and will require a valid datasource to be configured.</p>
</div>
<div class="paragraph">
<p>The main datasource is available for all modules as a bean named <code>acrossDataSource</code>.
Optionally a separate installer datasource can be configured that will be available as <code>acrossInstallerDataSource</code>.
If no separate installer datasource is specified, the default across datasource will be used.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
A valid default datasource is always required for installers to run.
It is not possible to configure only an installer datasource as the distributed locking mechanism uses the default datasource.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The installer datasource is the default datasource used for all <code>AcrossLiquibaseInstaller</code> instances.</p>
</div>
<h3 id="installer-applicationcontext" class="discrete">Installer ApplicationContext</h3>
<div class="paragraph">
<p>If installers need to be run for a module, a specific <code>ApplicationContext</code> is created in which the installers will be wired as beans.
This <code>ApplicationContext</code> can exist before the actual module <code>ApplicationContext</code> does.
However, all beans from the parent Across context and the module context - when created - are available in installers.</p>
</div>
<div class="paragraph">
<p>Installer contexts are temporary, once the Across context has bootstrapped they are closed.
Configuration and other annotated classes can be added to the installer context by using <code>ApplicationContextConfigurer</code> implementations, either on the <code>AcrossContext</code> or on an <code>AcrossModule</code>.</p>
</div>
<div class="paragraph">
<p>By default, the package <strong>installers.config</strong> relative to the module package will be scanned for beans to be added to the installer <code>ApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example using different datasource inside the modules</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="type">class</span> <span class="class">Config</span> <span class="directive">implements</span> AcrossContextConfigurer
{
    <span class="comment">/**
     * Installer tracking will be done on this datasource.
     */</span>
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> EmbeddedDatabase acrossDataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
                .setType( EmbeddedDatabaseType.HSQL )
                .setName( <span class="string"><span class="delimiter">&quot;</span><span class="content">core</span><span class="delimiter">&quot;</span></span> )
                .build();
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> EmbeddedDatabase moduleDataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
                .setType( EmbeddedDatabaseType.HSQL )
                .setName( <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> )
                .build();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> configure( AcrossContext context ) {
        ProvidedBeansMap beans = <span class="keyword">new</span> ProvidedBeansMap();
        beans.put( AcrossContext.DATASOURCE, <span class="keyword">new</span> PrimarySingletonBean( moduleDataSource() ) );
        beans.put( AcrossContext.INSTALLER_DATASOURCE, moduleDataSource() );

        context.addApplicationContextConfigurer( <span class="keyword">new</span> ProvidedBeansConfigurer( beans ),
                                                 ConfigurerScope.MODULES_ONLY );
        context.addInstallerContextConfigurer( <span class="keyword">new</span> ProvidedBeansConfigurer( beans ) );
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The installer context has no web support as it is a direct implementation of <code>AcrossApplicationContext</code> but does not implement <code>WebApplicationContext</code>.
</td>
</tr>
</table>
</div>
<div id="installer-conditionals" class="paragraph">
<p>Installers are registered as bean definitions in the installer <code>ApplicationContext</code>.
You can use any Spring <code>@Conditional</code> annotations to suppress installer execution, even if the run conditions are fulfilled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When registering bean definitions to the installer context, a good practice is to demarcate beans as <code>@Lazy</code>.
 In that case they will never get created if the installer conditionals fail.
</td>
</tr>
</table>
</div>
<h3 id="_acrossliquibaseinstaller" class="discrete">AcrossLiquibaseInstaller</h3>
<div class="paragraph">
<p>Across core comes with an <code>AcrossLiquibaseInstaller</code> class.
This is an abstract base class for executing liquibase XML resources.
Simply extending the base class and annotating as installer will execute an XML resource in the same package as the installer class against the installer datasource.</p>
</div>
<div class="listingblock">
<div class="title">Example using different datasource inside the modules</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">my.package</span>;

<span class="annotation">@Installer</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Liquibase installer</span><span class="delimiter">&quot;</span></span>, runCondition = InstallerRunCondition.AlwaysRun)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LiquibaseInstaller</span> <span class="directive">extends</span> AcrossLiquibaseInstaller
{
    <span class="comment">// Will execute the resource file 'my/package/LiquibaseInstaller.xml'</span>
    <span class="comment">// As liquibase has its own locking mechanism, we can safely always run (even though you should avoid this when possible)</span>

}</code></pre>
</div>
</div>
<h4 id="_schemaconfiguration" class="discrete">SchemaConfiguration</h4>
<div class="paragraph">
<p>An <code>AcrossLiquibaseInstaller</code> will use a <code>SchemaConfiguration</code> bean to configure its default schema and pass configuration properties.
A <code>SchemaConfiguration</code> for the current module will be looked up first, if none is found a default bean will be used if it exists.</p>
</div>
<div class="paragraph">
<p>The default <code>SchemaConfiguration</code> is a bean without any <code>@Module</code> annotations.
The presence of a <code>@Module</code> annotation marks that <code>SchemaConfiguration</code> as applying only for that particular module.</p>
</div>
<div class="paragraph">
<p>If no default or module <code>SchemaConfiguration</code> is found, the installer will continue without setting a default schema.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Adding <code>SchemaConfiguration</code> beans to a context directly via a <code>ProvidedBeansConfigurer</code> erases the visibility of bean declaration annotations.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of a configuration class defining some <code>SchemaConfiguration</code> beans</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">my.package</span>;

<span class="annotation">@EnableAcrossContext</span>
<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SchemaConfig</span>
{
    <span class="comment">/<strong>
     * AcrossLiquibaseInstaller in the QuotationModule will automatically pick up this SchemaConfiguration.
     * Liquibase scripts will run with 'MY_QUOTATIONS' as their default schema.
     */</span>
     <span class="annotation">@Bean</span>
     <span class="annotation">@Module</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">QuotationModule</span><span class="delimiter">&quot;</span></span> )
     <span class="directive">public</span> SchemaConfiguration userSchemaConfiguration() {
        <span class="keyword">return</span> <span class="keyword">new</span> SchemaConfiguration( <span class="string"><span class="delimiter">&quot;</span><span class="content">MY_QUOTATIONS</span><span class="delimiter">&quot;</span></span> );
     }

     <span class="comment">/</strong>
      * This is the default SchemaConfiguration.
      * AcrossLiquibaseInstaller in other module will pick up this SchemaConfiguration.
      */</span>
     <span class="annotation">@Bean</span>
     <span class="directive">public</span> SchemaConfiguration defaultSchemaConfiguration() {
        <span class="keyword">return</span> <span class="keyword">new</span> SchemaConfiguration( <span class="string"><span class="delimiter">&quot;</span><span class="content">MY_SCHEMA</span><span class="delimiter">&quot;</span></span> );
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Fixing a default schema</div>
<p>Alternatively the <code>SchemaConfiguration</code> bean schema can be ignored and a default schema fixed on the <code>AcrossLiquibaseInstaller</code>.
This is done in the installer implementation through the <code>setDefaultSchema()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Example fixed schema configuration using <code>AcrossLiquibaseInstaller#setDefaultSchema</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">my.package</span>;

<span class="comment">/**
 * Liquibase script of this installer will run with 'IM_SPECIAL' as default schema.
 * Regardless of any defined SchemaConfiguration.
 */</span>
<span class="annotation">@Installer</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Liquibase installer</span><span class="delimiter">&quot;</span></span>, runCondition = InstallerRunCondition.AlwaysRun)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpecialSchemaInstaller</span> <span class="directive">extends</span> AcrossLiquibaseInstaller
{
    <span class="directive">public</span> SpecialSchemaInstaller() {
        setDefaultSchema( <span class="string"><span class="delimiter">&quot;</span><span class="content">IM_SPECIAL</span><span class="delimiter">&quot;</span></span> );
    }
}</code></pre>
</div>
</div>
<h3 id="installer-settings" class="discrete">InstallerSettings</h3>
<div class="paragraph">
<p>For advanced configuration, both <code>AcrossContext</code> and <code>AcrossModule</code> allow <code>InstallerSettings</code> to be set.
<code>InstallerSettings</code> can be used to set the action (eg. force executed, skip) to be performed for one or more installers or installer groups.</p>
</div>
<div class="paragraph">
<p><code>InstallerSettings</code> accepts an <code>InstallerActionResolver</code> for determining install action at runtime.
Alternatively an installer can implement <code>InstallerActionResolver</code> that will be used in a second stage only if the original action is <code>EXECUTE</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the javadoc for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_version_information"><a class="anchor" href="#_module_version_information"></a>7. Module version information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across modules have version information attached in the form of an <code>AcrossVersionInfo</code> property.
This object provides information like the current version and time when it was built.
By default this information is fetched automatically from the <strong>META-INF/MANIFEST.MF</strong> resource.
The following attributes are required for a fully configured <code>AcrossVersionInfo</code> instance:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. MANIFEST attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Implementation-Title</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">across-web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project the class (<code>AcrossModule</code>) belongs to. Often also the JAR name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Implementation-Version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.1.RELEASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build version of the <code>AcrossModule</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Build-Time</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20150831-1011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp when the version was built (in <strong>yyyyMMdd-HHmm</strong> format).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using Maven a valid MANIFEST file can automatically be created using the following plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>maven-jar-plugin<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>2.6<span class="tag">&lt;/version&gt;</span>
       <span class="tag">&lt;configuration&gt;</span>
           <span class="tag">&lt;archive&gt;</span>
               <span class="tag">&lt;manifest&gt;</span>
                   <span class="tag">&lt;addDefaultImplementationEntries&gt;</span>true<span class="tag">&lt;/addDefaultImplementationEntries&gt;</span>
               <span class="tag">&lt;/manifest&gt;</span>
               <span class="tag">&lt;manifestEntries&gt;</span>
                   <span class="tag">&lt;Build-Time&gt;</span>${maven.build.timestamp}<span class="tag">&lt;/Build-Time&gt;</span>
               <span class="tag">&lt;/manifestEntries&gt;</span>
           <span class="tag">&lt;/archive&gt;</span>
       <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<h1 id="across-web" class="sect0"><a class="anchor" href="#across-web"></a>AcrossWebModule</h1>
<div class="sect1">
<h2 id="_general_information"><a class="anchor" href="#_general_information"></a>1. General information</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_about"><a class="anchor" href="#_about"></a>1.1. About</h3>
<div class="paragraph">
<p>AcrossWebModule is the only module included in the Across framework project.
It is the base module added to pretty much any Across web application.</p>
</div>
<div class="paragraph">
<p>AcrossWebModule activates Spring MVC support for all modules in an AcrossContext.
This means modules can configure the Spring MVC support, add controllers, servlets and filters.</p>
</div>
<div class="paragraph">
<p>On top of that, the out-of-the-box Spring MVC functionality is extended in several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <a href="#thymeleaf-dialect">Thymeleaf dialect</a> is provided for interacting with the Across web infrastructure</p>
</li>
<li>
<p>AcrossWebModule provides infrastructure for <a href="#web-templates">templates</a>, <a href="#menu-building">menu building</a> and <a href="#WebResourceRegistry">registering web resources</a></p>
</li>
<li>
<p>adding a <a href="#view-elements">programmatic model for creating UI components</a> from code</p>
</li>
<li>
<p>adding support for <a href="#extended-request-mapping">prefixing request mappings and adding custom request condition</a></p>
</li>
<li>
<p>auto configuration of a <a href="#multipart-config">Multipart filter</a></p>
</li>
<li>
<p>auto configuration of static resources with <a href="#client-side-caching">client-side caching</a> and <a href="#resource-url-versioning">url versioning</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>AcrossWebModule is not a Web CMS, it only supplies some common infrastructure generally useful when building web applications.</p>
</div>
<div class="paragraph">
<p>The across-web artifact also contains <code><a href="#across-application">@AcrossApplication</a></code>, a replacement for <code>@SpringBootApplication</code> when working with an AcrossContext.</p>
</div>
</div>
<div class="sect2">
<h3 id="_artifact_2"><a class="anchor" href="#_artifact_2"></a>1.2. Artifact</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>com.foreach.across<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>across-web<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="across-web-module-settings"><a class="anchor" href="#across-web-module-settings"></a>1.3. Module settings</h3>
<div class="paragraph">
<p>All properties start with the <strong>acrossWebModule.</strong> prefix.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views.thymeleaf.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should Thymeleaf view support be enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">views.jsp.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JSP/JSTL view support be enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative path for serving all static resources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/across/resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.folders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default subfolders of <em>views</em> that should be served as static resources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">js,css,static</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.versioning.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto configure versioning of the default resource resolvers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.versioning.version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed version if resource versioning is enabled.  Default will use build number or module version.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>null</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.caching.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto configure client-side caching of static resources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources.caching.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period for client-side resource caching (if enabled).  Defaults to 1 year.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>60*60*24*365</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerGlobalBuilderContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should a request-bound <code>ViewElementBuilderContext</code> be created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templates.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should support for <a href="#web-templates">web templates</a> be enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templates.auto-register</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <a href="#web-templates">web templates</a> are enabled, should named templates be autodetected.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipart.auto-configure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should a multipart resolver be configured automatically.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipart.settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MultipartConfigElement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multipart upload settings, if missing defaults will be used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>null</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">development-views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map&lt;String,String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of physical locations for views resources.  Only used if development mode is active.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Collections.emptyMap()</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_mvc_configuration"><a class="anchor" href="#_spring_mvc_configuration"></a>2. Spring MVC configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule sets up Spring MVC configuration including a single <code>DispatcherServlet</code> and default <code>HandlerMapping</code> beans.
In addition to the standard Spring MVC configuration, AcrossWebModule configures extra:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#static-resources">static resource resolving and versioning</a></p>
</li>
<li>
<p>support for <a href="#extended-request-mapping">custom request conditions and prefixed request mappings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>AcrossWebModule activates support for <code>WebMvcConfigurer</code> beans in other modules.
Any <code>WebMvcConfigurer</code>(often an extension of <code>WebMvcConfigurerAdapter</code>) will be detected and used to configure the mvc support.
Note that <code>WebMvcConfigurer</code> beans do not need to be exposed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acrosswebmodule_and_conversionservice"><a class="anchor" href="#_acrosswebmodule_and_conversionservice"></a>3. AcrossWebModule and ConversionService</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule requires a <code>FormattingConversionService</code> bean named <strong>mvcConversionService</strong> to be present.
If there is none, one will be created and exposed.  By default the parent <strong>conversionService</strong> bean will be reused if
it implements the right interface.  If you want to manage the <strong>mvcConversionService</strong> separately, simply create
 a <code>FormattingConversionService</code> with the right name in the parent context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ManualConversionServiceConfiguration</span>
{
        <span class="annotation">@Bean</span>(name = AcrossWebModule.CONVERSION_SERVICE_BEAN)
        <span class="directive">public</span> FormattingConversionService mvcConversionService() {
            <span class="keyword">return</span> <span class="keyword">new</span> FormattingConversionService();
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>mvcConversionService</strong> will be passed to all <code>WebMvcConfigurer</code> instances in order to add formatters.  It is also
the default <code>ConversionService</code> attached to the <code>WebDataBinder</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There will be at least 2 <code>ConversionService</code> beans in the across context when <code>AcrossWebModule</code> is enabled:
<strong>conversionService</strong> and <strong>mvcConversionService</strong>.  If you have duplicate bean exceptions due to unqualified autowiring,
you should make one of both primary.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_view_engines"><a class="anchor" href="#_view_engines"></a>4. View engines</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_thymeleaf_support"><a class="anchor" href="#_thymeleaf_support"></a>4.1. Thymeleaf support</h3>
<div class="paragraph">
<p>AcrossWebModule automatically activates <a href="http://www.thymeleaf.org">Thymeleaf</a> support for server-side templating.
Thymeleaf is a powerful templating language that allows its templates to be embedded inside the JAR files (something that is more cumbersome with regular JSP).</p>
</div>
<div class="paragraph">
<p>AcrossWebModule itself - as well as many other modules - use Thymeleaf extensively and add additional features for it (like <a href="#thymeleaf-dialect">custom dialects</a>).</p>
</div>
<div class="paragraph">
<p>The Thymeleaf templates embedded in modules are expected to be located in the <strong>views/th/<em>moduleResourceKey</em></strong> resources folder.
The supported file extension is <strong>*.html</strong>.
See the chapter on <a href="#static-resources-conventions">static resource conventions</a> for an example project layout.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jsp_support"><a class="anchor" href="#_jsp_support"></a>4.2. JSP support</h3>
<div class="paragraph">
<p>Support for regular JSP/JSTL can be enabled by setting the property <strong>acrossWebModule.views.jsp.enabled</strong> to <code>true</code>.</p>
</div>
<div class="sect3">
<h4 id="_combining_jsp_and_thymeleaf"><a class="anchor" href="#_combining_jsp_and_thymeleaf"></a>4.2.1. Combining JSP and Thymeleaf</h4>
<div class="paragraph">
<p>If both JSP and Thymeleaf support are enabled, you can easily use both view types at the same time.
The AcrossWebModule also provides a JSP tag that can be used to import Thymeleaf templates or fragments in a JSP rendering pipeline.
The same model (request attributes) should be available in the Thymeleaf template as in the calling JSP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="error">&lt;</span>%@ taglib prefix=&quot;across&quot; uri=&quot;http://across.foreach.com/tags&quot; %<span class="error">&gt;</span>
<span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>JSP including a Thymeleaf template<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;across:thymeleaf</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">th/mymodule/thymeleaf-from-jsp-include</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">child</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;across:thymeleaf</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">th/mymodule/thymeleaf-from-jsp-include :: fragment</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<h3 id="_using_other_templating_engines" class="discrete">Using other templating engines</h3>
<div class="paragraph">
<p>It is still possible to use additional templating engines.
You can do so by extending the AcrossWebModule configuration and registering custom Spring <code>ViewResolver</code> beans.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="static-resources"><a class="anchor" href="#static-resources"></a>5. Static resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule automatically enables serving of static resources bundled with modules.
With the default settings static resources will be configured with <a href="#resource-url-versioning">versioned urls</a> and <a href="#client-side-caching">client-side caching</a>.</p>
</div>
<div class="sect2">
<h3 id="static-resources-conventions"><a class="anchor" href="#static-resources-conventions"></a>5.1. Conventions</h3>
<div class="paragraph">
<p>The default resources are served from the <strong>/views</strong> folder on the classpath.
By default AcrossWebModule will serve resources from <em>/views/static</em>.
Additional subfolders can be configured with the <strong>acrossWebModule.resources.folders</strong> property.</p>
</div>
<div class="paragraph">
<p>By convention (and for best development mode support) module specific resources should be located in a subfolder with the <code>resourcesKey</code> of the module.</p>
</div>
<div class="listingblock">
<div class="title">Example resources layout for MyModule</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">src/main/resources
   views/
     static/
       MyModule/
         js/controller.js
         css/my-module.css
         img/logo.png
     th/
       MyModule/
         controller.html
         user-profile.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>The relative path under which the static resources are available is determined by the <strong>acrossWebModule.resources.path</strong> property.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-side-caching"><a class="anchor" href="#client-side-caching"></a>5.2. Client-side caching</h3>
<div class="paragraph">
<p>By default static resources will be cached on the client-side for a period of 1 year.
Disabling client-side caching is done with the <strong>acrossWebModule.resources.caching.enabled</strong> property.
If client-side caching is disabled, no cache headers will be sent to the client.</p>
</div>
<div class="paragraph">
<p>Configuring the caching period is done separately with the <strong>acrossWebModule.resources.caching.period</strong> property.
Setting the value to <strong>0</strong> with caching enabled will sent <strong>no-cache</strong> headers.
This is also the default if development mode is active.</p>
</div>
</div>
<div class="sect2">
<h3 id="resource-url-versioning"><a class="anchor" href="#resource-url-versioning"></a>5.3. Resource URL versioning</h3>
<div class="paragraph">
<p>By default AcrossWebModule enables <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-static-resources">Spring versioning of static resources</a>.
This will generate versioned URLs, create a <code>ResourceUrlProvider</code> bean and add a <code>ResourceUrlEncodingFilter</code> and <code>ResourceUrlProviderExposingInterceptor</code> to the request handlers.</p>
</div>
<div class="paragraph">
<p>Using versioned resource URLs is transparent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in Thymeleaf all relative links added with <code>@{/relative/path}</code> will be rewritten if necessary</p>
</li>
<li>
<p>in JSP the equivalent is the <code>&lt;spring:url value="/relative/path" var="url"/&gt;</code> tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these will work both with or without resource versioning.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If versioning is disabled, the <code>ResourceUrlProvider</code> will not be available on the request.
Modules using accessing the <code>ResourceUrlProvider</code> directly should built-in support for this.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_fixed_version_strategy"><a class="anchor" href="#_fixed_version_strategy"></a>5.3.1. Fixed version strategy</h4>
<div class="paragraph">
<p>AcrossWebModule supports automatic configuration of resource versioning using a single fixed version.
When enabled this means that resources of the form <strong>/across/resources/static/mymodule/mymodule.css</strong> will get rewritten to <strong>/across/resources/static/VERSION/mymodule/mymodule.css</strong>.</p>
</div>
<div class="paragraph">
<p>The fixed version used is determined as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>acrossWebModule.resources.versioning.version</strong> property</p>
</li>
<li>
<p><strong>build.number</strong> property</p>
</li>
<li>
<p>version of the AcrossWebModule</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using the fixed version strategy works well for relative includes in both CSS and JS files, avoiding the need to rewrite URLs inside those files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_version_strategy"><a class="anchor" href="#_customizing_the_version_strategy"></a>5.3.2. Customizing the version strategy</h4>
<div class="paragraph">
<p>It is possible to keep configuration of the default resources active but only change the version strategy used.
This can be done by injecting your own <code>VersionResourceResolver</code> bean named <strong>versionResourceResolver</strong> the AcrossWebModule context.</p>
</div>
<div class="listingblock">
<div class="title">Example providing custom version strategy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ModuleConfiguration</span>(AcrossWebModule.NAME)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CustomVersionResourceResolver</span>
{
        <span class="annotation">@Bean</span>
        <span class="directive">public</span> VersionResourceResolver versionResourceResolver() {
                <span class="keyword">return</span> <span class="keyword">new</span> VersionResourceResolver()
                                .addVersionStrategy( <span class="keyword">new</span> FixedVersionStrategy( <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> ), <span class="string"><span class="delimiter">&quot;</span><span class="content">/**/*.css</span><span class="delimiter">&quot;</span></span> )
                                .addVersionStrategy( <span class="keyword">new</span> FixedVersionStrategy( <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span> ), <span class="string"><span class="delimiter">&quot;</span><span class="content">/**</span><span class="delimiter">&quot;</span></span> );
        }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Because of limitations of the <code>CssLinkTransformer</code> in combination with a fixed version strategy, AcrossWebModule does not rewrite links inside css files.
If you absolutely need this in your application, you will have to disable the automatic resource versioning and configure it yourself.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="WebResourceRegistry"><a class="anchor" href="#WebResourceRegistry"></a>5.4. WebResourceRegistry</h3>
<div class="paragraph">
<p>AcrossWebModule allows for programatically registering web resources through the use of a <code>WebResourceRegistry</code>.
A new <code>WebResourceRegistry</code> is attached to every request and can be accessed as a request attribute or a handler method parameter.</p>
</div>
<div class="paragraph">
<p>Resources can be added in a group (eg: css, javascript) and with a specific location (eg: relative, views, external).
The groups can be used for retrieval of related resources, the location determines the <code>WebResourceTranslator</code> that will be used.
Web resource translating happens before the actual view is rendered and allows for the data to be converted into a more appropriate format for the view rendering.
Using the <code>WebResource.VIEWS</code> location for a web resource will have the relative path prefixed with the configured across web views resources prefix.</p>
</div>
<div class="paragraph">
<p>Resources can be identified with a unique key, ensuring they are added only once.</p>
</div>
<div class="listingblock">
<div class="title">Example controller registering specific web resources</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyController</span>
{
  <span class="annotation">@ModelAttribute</span>
  <span class="directive">public</span> <span class="type">void</span> registerWebResources( WebResourceRegistry webResourceRegistry ) {
    webResourceRegistry.add( WebResource.CSS, <span class="string"><span class="delimiter">&quot;</span><span class="content">//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css</span><span class="delimiter">&quot;</span></span>, WebResource.EXTERNAL );
    webResourceRegistry.add( WebResource.CSS, <span class="string"><span class="delimiter">&quot;</span><span class="content">/static/mymodule/css/main.css</span><span class="delimiter">&quot;</span></span>, WebResource.VIEWS );
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Views can access the <code>WebResourceRegistry</code> under the <strong>webResourceRegistry</strong> attribute.
It is however the view implementation that will determine how resources are handled: for example the Thymeleaf template rendering them in the head section of a page.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_webresourcepackage"><a class="anchor" href="#_webresourcepackage"></a>5.4.1. WebResourcePackage</h4>
<div class="paragraph">
<p>To avoid adding single items, web resources can be bundled into a <code>WebResourcePackage</code> and registered with the <code>WebResourcePackageManager</code>.
Adding an entire package can then be done by calling <code>WebResourceRegistry#addPackage</code> with the right package name.</p>
</div>
<div class="listingblock">
<div class="title">Example creating a WebResourcePackage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BootstrapUiWebResources</span> <span class="directive">extends</span> SimpleWebResourcePackage
{
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> VERSION = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.3.5</span><span class="delimiter">&quot;</span></span>;
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">bootstrap</span><span class="delimiter">&quot;</span></span>;

  <span class="directive">public</span> BootstrapUiWebResources() {
    setDependencies( JQueryWebResources.NAME );     <span class="comment">// Install the jquery package first</span>
    setWebResources(
      <span class="keyword">new</span> WebResource( WebResource.CSS, NAME,
                       <span class="string"><span class="delimiter">&quot;</span><span class="content">//maxcdn.bootstrapcdn.com/bootstrap/</span><span class="delimiter">&quot;</span></span> + VERSION + <span class="string"><span class="delimiter">&quot;</span><span class="content">/css/bootstrap.min.css</span><span class="delimiter">&quot;</span></span>,
                       WebResource.EXTERNAL ),
      <span class="keyword">new</span> WebResource( WebResource.JAVASCRIPT_PAGE_END, NAME,
                       <span class="string"><span class="delimiter">&quot;</span><span class="content">//maxcdn.bootstrapcdn.com/bootstrap/</span><span class="delimiter">&quot;</span></span> + VERSION + <span class="string"><span class="delimiter">&quot;</span><span class="content">/js/bootstrap.min.js</span><span class="delimiter">&quot;</span></span>,
                       WebResource.EXTERNAL )
      );
  }

  <span class="annotation">@Autowired</span>
  <span class="directive">public</span> <span class="type">void</span> registerPackage( WebResourcePackageManager packageManager ) {
    packageManager.register( NAME, <span class="local-variable">this</span> );
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="menu-building"><a class="anchor" href="#menu-building"></a>6. Building menus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule provides some infrastructure to build a tree-like menu.
The output class is a <code>Menu</code> instance that is created by the <code>MenuFactory</code> service.</p>
</div>
<div class="paragraph">
<p>When building a menu, a <code>BuildMenuEvent</code> is published with the menu instance, the name of the menu will be the name of the event.
The <code>BuildMenuEvent</code> provides access to a <code>PathBasedMenuBuilder</code> that allows asynchronous registering of menu items with a unique hierarchical path.
After the event handling the actual menu will be built and path structure will be used for the tree hierarchy.</p>
</div>
<div class="paragraph">
<p>It is still up to the developer to actually output the <code>Menu</code> in some fashion, for example by rendering it in the Thymeleaf template.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view-elements"><a class="anchor" href="#view-elements"></a>7. ViewElement infrastructure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule provides a programmatic model for rendering UI components.
A single UI component in this context is called a <code>ViewElement</code>.</p>
</div>
<div class="sect2">
<h3 id="_viewelement"><a class="anchor" href="#_viewelement"></a>7.1. ViewElement</h3>
<div class="paragraph">
<p><code>ViewElement</code> implementations usually correspond to one or more HTML nodes.
AcrossWebModule comes with a default set <code>ViewElement</code> implementation for rendering Bootstrap markup elements.
This is done through a collection of Thymeleaf processors for rendering <code>ViewElement</code> components.</p>
</div>
<div class="paragraph">
<p>You can render a <code>ViewElement</code> available on the model anywhere in a Thymeleaf template by using the <em>across:view</em> tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;across:view</span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${myViewElement}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You usually do not want to cache and reuse <code>ViewElement</code> components.
It is better to cache <code>ViewElementBuilder</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_default_properties"><a class="anchor" href="#_default_properties"></a>7.2. Default properties</h3>
<div class="paragraph">
<p>In its most simple form, a <code>ViewElement</code> has the following properties:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional internal name of the element.
This name can be used to retrieve the element from a <code>ContainerViewElement</code>.
Use <code>ContainerViewElementUtils</code> to query and modify containers.
</p><p class="tableblock">See <a href="#development-mode">development mode rendering</a> for more information to retrieve generated view names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>elementType</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>required</strong> type identification for the element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>customTemplate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional template name.
If a custom template is specified, it will be used to render the <code>ViewElement</code> instead of the default processor.
By default only Thymeleaf templates are supported.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_custom_template"><a class="anchor" href="#_custom_template"></a>7.2.1. Custom template</h4>
<div class="paragraph">
<p>Every <code>ViewElement</code> allows you to configure a <strong>customTemplate</strong>.
Only Thymeleaf fragments are supported, if you specify a Thymeleaf template without a fragment, a <strong>render(component)</strong> fragment will be appended.
The <strong>component</strong> variable will always contain the <code>ViewElement</code> instance that is being rendered.</p>
</div>
<div class="paragraph">
<p>You can use a different input variable by specifying the <strong>${component}</strong> manually in your template specification.</p>
</div>
<div class="ulist">
<div class="title">Examples:</div>
<ul>
<li>
<p><code>th/mymodule/mytemplate</code> results in <code>th/mymodule/mytemplate :: render(component)</code></p>
</li>
<li>
<p><code>th/mymodule/mytemplate :: myfragment</code> results in <code>th/mymodule/mytemplate :: myfragment(component)</code></p>
</li>
<li>
<p><code>th/mymodule/mytemplate :: myfragment(${someModelAttribute},${component})</code> results in <code>th/mymodule/mytemplate :: myfragment(attributeValue,component)</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You should only use model attributes that are sure to be available when the template is being rendered.
It is usually best to pass the required values as attributes on the <code>ViewElement</code> itself.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the <code>TemplateViewElement</code> if you only want to render a custom template and optionally pass it some attributes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewelementbuilder"><a class="anchor" href="#_viewelementbuilder"></a>7.3. ViewElementBuilder</h3>
<div class="paragraph">
<p>A <code>ViewElementBuilder</code> is a simple API for creating a <code>ViewElement</code> instance based on a configuration and a given <code>ViewElementBuilderContext</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ViewElementBuilderContext</code> represents the runtime context when creating the element.
It is a way to pass attributes required for building the elements, and it also gives access to default request related beans like the <code>WebResourceRegistry</code> or the <code>WebAppLinkBuilder</code>.</p>
</div>
<div class="paragraph">
<p>AcrossWebModule comes with a number of default <code>ViewElementBuilder</code> implementations for both simple elements and more complex components.</p>
</div>
<div class="sect3">
<h4 id="_global_viewelementbuildercontext"><a class="anchor" href="#_global_viewelementbuildercontext"></a>7.3.1. Global ViewElementBuilderContext</h4>
<div class="paragraph">
<p>Most <code>ViewElementBuilder</code> implementations extend <code>GlobalContextSupportingViewElementBuilder</code>.
This class provides a parameterless <code>build()</code> method that will attempt to retrieve a <code>ViewElementBuilderContext</code> from the current thread, or from the request attached to the thread.
If no global <code>ViewElementBuilderContext</code> is registered however, calls to <code>build()</code> will throw an exception.</p>
</div>
<div class="paragraph">
<p>See the <code>ViewElementBuilderContextInterceptor</code> for an interceptor that creates a global <code>ViewElementBuilderContext</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewelementbuildercontext_in_controllers"><a class="anchor" href="#_viewelementbuildercontext_in_controllers"></a>7.3.2. ViewElementBuilderContext in controllers</h4>
<div class="paragraph">
<p>If there is a global <code>ViewElementBuilderContext</code> available, you can also <code>ViewElementBuilderContext</code> as a method argument in web controller methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_application_links"><a class="anchor" href="#_creating_application_links"></a>7.3.3. Creating application links</h4>
<div class="paragraph">
<p>The <code>ViewElementBuilderContext</code> provides a <code>buildLink(String)</code> method that will resolve a link using the <code>WebAppLinkBuilder</code> attribute that is available on the builder context.
By default the request-bound <code>WebAppLinkBuilder</code> is already set.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dev-mode-rendering"><a class="anchor" href="#dev-mode-rendering"></a>7.4. Development mode rendering</h3>
<div class="paragraph">
<p>If development mode is active, all <code>ViewElement</code> names will be rendered in the markup.
Start and end of the element rendering will be marked by a HTML comment.
If the <code>ViewElement</code> is a node (xml-type element) it will also have a data attribute <strong>data-ax-dev-view-element</strong> containing the name.</p>
</div>
<div class="listingblock">
<div class="title">Example markup when rendered in development mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="comment">&lt;!--[ax:title]--&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity.title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity.title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data-ax-dev-view-element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-control</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="comment">&lt;!--[/ax:title]--&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is not required for a <code>ViewElement</code> to have a name, nor is it required for that name to be unique.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="web-templates"><a class="anchor" href="#web-templates"></a>8. Layout templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule provides support for simple layout processing.
A controller method can be linked to a specific template which will determine some pre- and post-processing that might be done.
The base infrastructure is provided by <code>WebTemplateProcessor</code>, <code>WebTemplateInterceptor</code> and <code>WebTemplateRegistry</code>.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_template"><a class="anchor" href="#_creating_a_template"></a>8.1. Creating a template</h3>
<div class="paragraph">
<p>The easiest way to create a new template is to create a bean extending <code>LayoutTemplateProcessorAdapterBean</code>.
Your implementation should get a unique name and a path to the template view file.
This basic template implementation has adapter methods for registering of web resources and generating one or more menu structures.</p>
</div>
<div class="listingblock">
<div class="title">Example layout template implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTemplate</span> <span class="directive">extends</span> LayoutTemplateProcessorAdapterBean {

    <span class="directive">public</span> MyTemplate() {
        <span class="local-variable">super</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">MyTemplate</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">th/mysite/layout</span><span class="delimiter">&quot;</span></span> );
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> registerWebResources( WebResourceRegistry registry ) {
        registry.add( WebResource.CSS, <span class="string"><span class="delimiter">&quot;</span><span class="content">/static/mysite/css/main.css</span><span class="delimiter">&quot;</span></span>, WebResource.VIEWS );
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> buildMenus( MenuFactory menuFactory ) {
        menuFactory.buildMenu( <span class="string"><span class="delimiter">&quot;</span><span class="content">topMenu</span><span class="delimiter">&quot;</span></span> );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the template is applied it will take the original view name and put it as a model attribute with the key <strong>childPage</strong>.
The actual template view can then dispatch to the original view (or parts of it) when building the final layout.</p>
</div>
<div class="listingblock">
<div class="title">Example Thymeleaf template that renders the content fragment of the original view</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;title&gt;</span>My Site<span class="tag">&lt;/title&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">th:each</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javascript : ${webResourceRegistry.getResources('javascript')}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{${javascript.data}}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${javascript.location != 'inline'}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>

    <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:each</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css : ${webResourceRegistry.getResources('css')}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">th:href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{${css.data}}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${childPage} :: content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Insert original view
    <span class="tag">&lt;/div&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">th:each</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javascript : ${webResourceRegistry.getResources('javascript-page-end')}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{${javascript.data}}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${javascript.location != 'inline'}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the initial <code>registerWebResources(WebResourceRegistry)</code> has been executed by the template component, an <code>BuildTemplateWebResourcesEvent</code> with the template name will be published.
This allows event listeners to add additional resources for a specific template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_linking_a_template_to_a_controller"><a class="anchor" href="#_linking_a_template_to_a_controller"></a>8.2. Linking a template to a controller</h3>
<div class="paragraph">
<p>Any controller method can specify the template to use by setting the <code>@Template</code> annotation with the unique template name.
The <code>@Template</code> annotation can be set on the <code>@Controller</code> itself (in which case it will apply to all mapping methods) or on mapping method directly.
The latter will always take precedence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can always clear a template from being applied by setting a <code>@ClearTemplate</code> annotation on a method.
Special Spring MVC return options (like methods annotated with <code>@ResponseBody</code>) will automatically suppress the template.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Methods in a <code>@Controller</code> do not take any <code>@Template</code> annotations of their <code>@ControllerAdvice</code> beans into account and vice versa.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_linking_a_template_to_an_exception_handler"><a class="anchor" href="#_linking_a_template_to_an_exception_handler"></a>8.3. Linking a template to an exception handler</h3>
<div class="paragraph">
<p>Just like <code>@Template</code> can be used on any <code>@RequestMapping</code> method, it can also be used on a <code>@ExceptionHandler</code> method.
Since an exception handler uses its own template, a template might be executed twice if an exception occurs.
Initially a template might have been executed for the controller method.
In case of an exception, that template will be cleared and a new <code>WebResourceRegistry</code> will be created for the <code>@ExceptionHandler</code> along with the optional template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_the_default_template"><a class="anchor" href="#_registering_the_default_template"></a>8.4. Registering the default template</h3>
<div class="paragraph">
<p>If no explicit template is specified, the default template will be used it there is one.
The default template must be set on the <code>WebTemplateRegistry</code>.
 set on the <code>WebTemplateRegistry</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example template registering itself as default</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTemplate</span> <span class="directive">extends</span> LayoutTemplateProcessorAdapterBean {
    ...

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> registerAsDefaultTemplate( WebTemplateRegistry webTemplateRegistry ) {
        webTemplateRegistry.setDefaultTemplateName( getName() );
    }

    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_partial_rendering"><a class="anchor" href="#_partial_rendering"></a>9. Partial rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apart from <a href="#web-templates">layout templates</a>, AcrossWebModule also activates support for partial rendering: rendering only a specific fragment of a (Thymeleaf) template, or even a single <code>ViewElement</code>.
This can be done by simply specifying the fragment to render as a <strong>_partial</strong> request parameter.</p>
</div>
<div class="paragraph">
<p>Partial rendering is done by specifying the Thymeleaf fragment name in the <strong>_partial</strong> request parameter.
If you want to render a single <code>ViewElement</code>, you should specify the <code>ViewElement</code> name prefixed with <strong>::</strong>.</p>
</div>
<div class="paragraph">
<p>If a partial fragment is specified, the entire <code>WebTemplateProcessor</code> will be skipped, only the target view will be rendered.
All other controller code will still be executed, all markup will still be built, but only the markup of the selected elements will be written to the response.</p>
</div>
<div class="paragraph">
<div class="title">Example</div>
<p>Assume we create a single <code>ViewElement</code> with a specific name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/render</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> get() {
  model.addAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">myViewElement</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> TextViewElement( <span class="string"><span class="delimiter">&quot;</span><span class="content">myViewElement</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">some text</span><span class="delimiter">&quot;</span></span> ) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we render it in the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h1&gt;</span>title<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:fragment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mycontent</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;across:view</span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${myViewElement}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>/render</em> would output <em>&lt;h1&gt;title&lt;/h1&gt;&lt;div&gt;some text&lt;/div&gt;</em></p>
</li>
<li>
<p><em>/render?_partial=mycontent</em> would output <em>&lt;div&gt;some text&lt;/div&gt;</em></p>
</li>
<li>
<p><em>/render?_partial=::myViewElement</em> would output <em>some text</em></p>
</li>
<li>
<p><em>/render?_partial=mycontent::myViewElement</em> would also output <em>some text</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="localized-text"><a class="anchor" href="#localized-text"></a>10. Localizing text</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Text message codes can be translated into text messages via the <code>MessageSource</code>.
AcrossWebModule also provides a utility bean that wraps the <code>MessageSource</code> for optional resolving of message codes.</p>
</div>
<h3 id="_localizedtextresolver" class="discrete">LocalizedTextResolver</h3>
<div class="paragraph">
<p>The <code>LocalizedTextResolver</code> can be used to localize text snippets.
A text snippet can either be the final text, or a message code construct.</p>
</div>
<div class="paragraph">
<p>If the snippet is a message code construct, the message code will be resolved and the return value used.
Otherwise the original text will be used.
This makes the <code>LocalizedTextResolver</code> useful for integrating with previously existing code where fixed text has been provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>LocalizedTextResolver</code> is a simple generic interface.
You could easily plug in another implementation by registering another implementation as the primary bean.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Examples of text snippet resolving</div>
<ul>
<li>
<p><strong>Some text</strong> will always return <em>Some text</em></p>
</li>
<li>
<p><strong>#{message.code}</strong> will resolve <em>message.code</em> and either return the resolved message or the unresolved code</p>
</li>
<li>
<p><strong>#{message.code=Default message}</strong> will resolve <em>message.code</em> and return the resolved message or <em>Default message</em> if unresolvable</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_urls"><a class="anchor" href="#_generating_urls"></a>11. Generating URLs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="web-app-path-resolver"><a class="anchor" href="#web-app-path-resolver"></a>11.1. WebAppPathResolver and path prefixing</h3>
<div class="paragraph">
<p>AcrossWebModule introduces the <code><a href="#prefix-request-mappings">PrefixingRequestMappingHandlerMapping</a></code>.
This allows <code>@RequestMapping</code> methods to be prefixed at runtime, based on configuration.</p>
</div>
<div class="paragraph">
<p>Some standard Across modules like AdminWebModule and DebugWebModule make use of this functionality.</p>
</div>
<div class="paragraph">
<p>Because the actual relative path of a controller is then not known during development, you can define a relative path with a prefix.
If you provide your path to the <code>WebAppPathResolver</code> bean, the prefix will then be replaced at runtime by the final path.</p>
</div>
<div class="paragraph">
<p>The <a href="#thymeleaf-dialect">AcrossWebModule Thymeleaf dialect</a> integrates with the <code>WebAppPathResolver</code> so prefix based paths are supported directly in templates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want to ensure your relative path is never prefixed, start it with an exclamation mark (!).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_default_prefixes"><a class="anchor" href="#_default_prefixes"></a>11.1.1. Default prefixes</h4>
<div class="paragraph">
<p>AcrossWebModule registers default prefixers for static resources:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@resource</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static resources in the root resources folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@static</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static resources in the <em>static</em> subfolder.
This is a short-hand for <em>@resource:/static/&lt;path&gt;</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_path_resolving_examples"><a class="anchor" href="#_path_resolving_examples"></a>11.1.2. Path resolving examples</h4>
<div class="paragraph">
<p>The examples assume that <em>res</em> is the configured <strong>acrossWebModule.resources.path</strong>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Input</th>
<th class="tableblock halign-left valign-top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>/my/path</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>/my/path</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@resource:/my/path</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>/res/my/path</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@static:/my/path?id=10#home</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>/res/static/my/path?id=10#home</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>redirect:@resource/my/path</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>redirect:/res/my.path</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>!@resource/my/path</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@resource/my/path</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_registering_your_own_prefixing_handler_mapping_and_resolver"><a class="anchor" href="#_registering_your_own_prefixing_handler_mapping_and_resolver"></a>11.1.3. Registering your own prefixing handler mapping and resolver</h4>
<div class="paragraph">
<p>See <code>PrefixingHandlerMappingConfiguration</code> and <code>PrefixingPathContext</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_webapplinkbuilder"><a class="anchor" href="#_webapplinkbuilder"></a>11.2. WebAppLinkBuilder</h3>
<div class="paragraph">
<p>The <code>WebAppPathResolver</code> will only replace the relative path prefix, but to generate a valid application link you would still need to prepend the possible context path as wel as encode the URL.
If you want to generate a complete link from code, you can use the <code>WebAppLinkBuilder</code> bean.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You should only use the the <code>WebAppLinkBuilder</code> if your links will not be processed additionally.
To generate redirect paths, or links for a <code>spring:url</code> or Thymeleaf link builder <code>@{}</code>, use the <code>WebAppPathResolver</code>.<br>
<br>
Otherwise you could end up with links having the context path added twice.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="thymeleaf-dialect"><a class="anchor" href="#thymeleaf-dialect"></a>12. Thymeleaf dialect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule also registers a custom Thymeleaf dialect.
The Thymeleaf dialect uses the prefix <strong>across</strong> and offers a number of utility elements, attributes and expression objects.</p>
</div>
<div class="sect2">
<h3 id="_element_processors"><a class="anchor" href="#_element_processors"></a>12.1. Element processors</h3>
<div class="paragraph">
<p>The <code>AcrossWebDialect</code> adds the following elements that can be used in HTML templates:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>across:view</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a <code>ViewElement</code> as <em>element</em> attribute and will be replaced by the rendering of that <code>ViewElement</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>element</em> : <code>ViewElement</code> instance</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_attribute_processors"><a class="anchor" href="#_attribute_processors"></a>12.2. Attribute processors</h3>
<div class="paragraph">
<p>The <code>AcrossWebDialect</code> adds the following attributes that can be used in HTML templates:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>across:resource</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a relative path to a static resource.
Will generate a valid url path to that static resource and will write the value as a new attribute.
The name of the attribute that will be written depends on the element the attribute is used on.
</p><p class="tableblock">All HTML5 elements supporting <strong>src</strong> or <strong>href</strong> attributes are supported, along with <em>image</em> and <em>use</em> elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;a across:resource="/img"/&gt;</em><br>
output: <em>&lt;a href="/res/img"&gt;</em>
</p><p class="tableblock"><em>&lt;script across:resource="/js/my.js"/&gt;</em><br>
output: <em>&lt;script src="/res/js/my.js"/&gt;</em>
</p><p class="tableblock"><em>&lt;image across:resource="/img"/&gt;</em><br>
output: <em>&lt;image xlink:href="/res/img"/&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>across:static</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a relative path to a resource in the <em>static</em> subfolder.
Using <em>across:static="/img"</em> would be the same as using <em>across:resource="/static/img"</em>.
Supports the same elements as <em>across:resource</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;a across:static="/img"/&gt;</em><br>
 output: <em>&lt;a href="/res/static/img"&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>across:resource-attr-name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <strong>across:resource</strong> except the resulting attribute name will be <em>attr-name</em>.<br>
Any double dash (--) will be replaced by a colon (:).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;a across:resource-data-url="/img"/&gt;</em><br>
 output: <em>&lt;a data-url="/res/img"&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>across:static-attr-name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <strong>across:static</strong> except the resulting attribute name will be <em>attr-name</em>.<br>
Any double dash (--) will be replaced by a colon (:).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;a across:static-data-url="/img"/&gt;</em><br>
 output: <em>&lt;a data-url="/res/static/img"&gt;</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_expression_objects"><a class="anchor" href="#_expression_objects"></a>12.3. Expression objects</h3>
<div class="paragraph">
<p>The <code>AcrossWebDialect</code> makes the following expression objects available for script execution:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>#webapp</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebAppPathResolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for generating prefixed links based on a relative path.
For example to static resources.
</p><p class="tableblock">These links can still be processed by the Thymeleaf link builder (<code>@{..}</code>).
Usually not necessary to use the <code>#webapp</code> however, see the <a href="#url-support">URL support section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>#htmlIdStore</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlIdStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the generated HTML id attribute for a <code>ViewElement</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="url-support"><a class="anchor" href="#url-support"></a>12.4. URL support</h3>
<div class="paragraph">
<p>Apart from the availability of <strong>#webapp</strong>, AcrossWebModule activates transparent support for the <a href="#web-app-path-resolver"><code>WebAppPathResolver</code></a> on Thymeleaf URL generation.<br></p>
</div>
<div class="paragraph">
<p>Example:
<em>&lt;img th:src="@{@static:/img}"&gt;</em> would produce <em>&lt;img src="/res/static/img"&gt;</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extended-request-mapping"><a class="anchor" href="#extended-request-mapping"></a>13. @RequestMapping extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule adds several extensions to the out-of-the-box Spring MVC functionality.</p>
</div>
<div class="sect2">
<h3 id="customrequestcondition"><a class="anchor" href="#customrequestcondition"></a>13.1. @CustomRequestMapping</h3>
<div class="paragraph">
<p>Default <code>@RequestMapping</code> implementations can be further specified by adding custom request conditions using <code>@CustomRequestMapping</code> annotations.
The latter allows you to restrict a <code>@RequestMapping</code> on any annotation attribute value on the handler method, or even any attribute value that is available on the <code>HttpServletRequest</code>.</p>
</div>
<div class="paragraph">
<p>A <code>@CustomRequestMapping</code> allows you to specify a number of <code>CustomRequestCondition</code> classes.
When building the request mapping info, AcrossWebModule will create beans of every <code>CustomRequestCondition</code> and will supply them with the <code>AnnotatedElement</code> that represents the handler method or handler type they were configured on.
Multiple <code>CustomRequestCondition</code> classes can be specified and they can be combined on both handler type and handler method, just like the regular <code>@RequestMapping</code>.</p>
</div>
<div class="paragraph">
<p>You can also use <code>@CustomRequestMapping</code> as a meta-annotation, which is often much easier in use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When adding multiple <code>CustomRequestCondition</code> to a mapping, the mapping will only be applied if <strong>all</strong> conditions match.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Example @CustomRequestMapping</div>
<p>The following example creates an additional request mapping condition that will only use that mapping if the request has a specific referrer header value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestController</span> {
    <span class="comment">/**
     * Example mapping that accepts only GET requests made to the
     * fromGoogle path if the request referrer header contains
     * http://www.google.com.
     */</span>
    <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/fromGoogle</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@ReferrerMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.google.com</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> google() {
        ...
    }
}

<span class="comment">/**
 * Custom mapping that will only match if any of the referrers are set.
 * If both type and method level annotation is present, the method level annotation
 * attributes will replace the type level attributes.  This is taken care of in the
 * combine() method of the ReferrerRequestCondition.
 */</span>
<span class="annotation">@Target</span>({ <span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.TYPE })
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@CustomRequestMapping</span>(ReferrerRequestCondition.class)
<span class="directive">private</span> <span class="annotation">@interface</span> ReferrerMapping
{
    <span class="comment">// possible header values - the mapping will apply if the request</span>
    <span class="comment">// referrer has any of these values</span>
    <span class="predefined-type">String</span><span class="type">[]</span> value();
}

<span class="comment">/**
 * Condition implementation.  This will be instantiated as a bean,
 * so wiring other components is possible as well as long as they are
 * visible in the AcrossWebModule context.
 */</span>
<span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ReferrerRequestCondition</span> <span class="directive">extends</span> AbstractCustomRequestCondition&lt;ReferrerRequestCondition&gt;
{
    <span class="directive">private</span> <span class="predefined-type">String</span><span class="type">[]</span> referrers = <span class="keyword">new</span> <span class="predefined-type">String</span>[<span class="integer">0</span>];

    <span class="comment">// get the configured headers from the annotation</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setAnnotatedElement( <span class="predefined-type">AnnotatedElement</span> element ) {
        referrers = AnnotatedElementUtils.findMergedAnnotation( element, ReferrerMapping.class )
                                         .value();
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; getContent() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList( referrers );
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> getToStringInfix() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content"> || </span><span class="delimiter">&quot;</span></span>;
    }

    <span class="comment">// no relevant combination - other simply replaces this one</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ReferrerRequestCondition combine( ReferrerRequestCondition other ) {
        <span class="keyword">return</span> other;
    }

    <span class="comment">// return self if headers matches, else there is no matching condition</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ReferrerRequestCondition getMatchingCondition( HttpServletRequest request ) {
        <span class="keyword">if</span> ( StringUtils.containsAny( request.getHeader( HttpHeaders.REFERER ), referrers ) ) {
            <span class="keyword">return</span> <span class="local-variable">this</span>;
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="comment">// always consider them equal</span>
    <span class="comment">// there is no relevant ordering if headers are different</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> compareTo( ReferrerRequestCondition other, HttpServletRequest request ) {
        <span class="keyword">return</span> <span class="integer">0</span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prefix-request-mappings"><a class="anchor" href="#prefix-request-mappings"></a>13.2. Prefixed request mappings</h3>
<div class="paragraph">
<p>AcrossWebModule contains a <code>PrefixingRequestMappingHandlerMapping</code> implementation.
The <code>PrefixingRequestMappingHandlerMapping</code> allows request mappings to be prefixed at runtime.
Core infrastructure is the <code>PrefixingRequestMappingHandlerMapping</code> and the <code>PrefixingHandlerMappingConfigurer</code>.
The latter can be used to add interceptors only to request mappings attached to a specific <code>PrefixingRequestMappingHandlerMapping</code> instance.</p>
</div>
<div class="paragraph">
<p><code>PrefixingRequestMappingHandlerMapping</code> also fully supports <a href="#customrequestcondition">custom request conditions</a>.</p>
</div>
<div class="paragraph">
<p>Examples of prefixing request mappings can be found in the <a href="https://foreach.atlassian.net/wiki/display/AX/AdminWebModule">AdminWebModule</a> and <a href="https://foreach.atlassian.net/wiki/display/AX/DebugWebModule">DebugWebModule</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="default-http-encoding"><a class="anchor" href="#default-http-encoding"></a>14. Default HTTP encoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule registers a default <code>CharacterEncodingFilter</code> that forces the request and response encoding to use UTF-8.
This is done through the <code>HttpEncodingAutoConfiguration</code> from Spring Boot and can be controlled with the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.http.encoding.enabled</p>
</li>
<li>
<p>spring.http.encoding.charset</p>
</li>
<li>
<p>spring.http.encoding.force</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a <code>CharacterEncodingFilter</code> bean is found in the parent <code>ApplicationContext</code> but default HTTP encoding is enabled, AcrossWebModule will take care of registering that filter bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-servlet-registration"><a class="anchor" href="#dynamic-servlet-registration"></a>15. Registering servlets and filters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to register <code>Servlet</code> and <code>Filter</code> instances from within an Across module by providing <code>ServletContextInitializer</code> beans.
During bootstrap, AcrossWebModule will detect these beans and execute them <a href="#ordering-beans">in order</a>.</p>
</div>
<div class="paragraph">
<p>For the <code>ServletContext</code> to be customized, the <code>AcrossContext</code> must be bootstrapped during the <code>ServletContext</code> initialization.
This is the default when you use <code>@AcrossApplication</code> with an embedded container (Spring Boot application).
When deploying to a separate container, you can use <code>AbstractAcrossServletInitializer</code> to achieve the same.</p>
</div>
<div class="paragraph">
<div class="title">Conditionals</div>
<p><code>@ConditionalOnConfigurableServletContext</code> can be used to verify that the context is being bootstrapped in a web configuration where the <code>ServletContext</code> allows customization.
Likewise <code>@ConditionalOnNotConfigurableServletContext</code> can be used to check the opposite is true.</p>
</div>
<div class="listingblock">
<div class="title">Example registering the resourceUrlEncodingFilter after all other filters</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="annotation">@ConditionalOnProperty</span>(prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">acrossWebModule.resources.versioning</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span>, matchIfMissing = <span class="predefined-constant">true</span>)
<span class="annotation">@ConditionalOnConfigurableServletContext</span>
<span class="directive">public</span> FilterRegistrationBean resourceUrlEncodingFilterRegistration() {
    FilterRegistrationBean registration = <span class="keyword">new</span> FilterRegistrationBean();
    registration.setName( RESOURCE_URL_ENCODING_FILTER );
    registration.setFilter( <span class="keyword">new</span> ResourceUrlEncodingFilter() );
    registration.setAsyncSupported( <span class="predefined-constant">true</span> );
    registration.setMatchAfter( <span class="predefined-constant">true</span> );
    registration.setUrlPatterns( <span class="predefined-type">Collections</span>.singletonList( <span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span> ) );
    registration.setDispatcherTypes( DispatcherType.REQUEST, DispatcherType.ERROR, DispatcherType.ASYNC );
    registration.setOrder( Ordered.LOWEST_PRECEDENCE );

    <span class="keyword">return</span> registration;
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>ServletContextInitializer</code> beans can be ordered but the order between initializers defined inside the Across context and outside the context (on application configuration level) is <em>non deterministic</em>.
To enforce overall ordering, it might be easiest to add those initializers to a module using <code>@ModuleConfiguration</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multipart-config"><a class="anchor" href="#multipart-config"></a>16. Multipart support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default AcrossWebModule will attempt to automatically configure a <code>MultipartFilter</code> to support multipart form data.
When correctly configured, this will enable multipart support for all servlets and web requests.</p>
</div>
<div class="paragraph">
<div class="title">Servlet container support</div>
<p>By default a <code>StandardServletMultipartFilter</code> is being added, that builds on top of the Servlet 3.0 specification.
Servlets will still need a <code>MultipartConfigElement</code> set for multipart data to be handled correctly.
The latter is done automatically for the <code>DispatcherServlet</code>.</p>
</div>
<div class="paragraph">
<div class="title">Customizing the multipart configuration</div>
<p>Common settings (eg. max file size) can be customized by providing a <code>MultipartConfigElement</code> bean.
This bean will be automatically picked up for the configuration.
If none is present, AcrossWebModule will create a default bean.</p>
</div>
<div class="paragraph">
<div class="title">Apache Commons support</div>
<p>If <a href="#commons-fileupload-url">Apache Commons FileUpload</a> is available on the classpath, the filter will be configured using a <code>CommonsMultipartResolver</code> instead.</p>
</div>
<div class="paragraph">
<div class="title">Manually creating a MultipartResolver</div>
<p>It is also possible to manually create a <code>MultipartResolver</code> bean.
The bean name will determine how multipart resolving is applied:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>filterMultipartResolver</strong></dt>
<dd>
<p>Will still enable the <code>MultipartFilter</code> to be registered but will use the configured bean as its internal resolver.</p>
</dd>
<dt class="hdlist1"><strong>multipartResolver</strong></dt>
<dd>
<p>Will disable the <code>MultipartFilter</code> registration, but will register the resolver on the <code>DispatcherServlet</code>.
Multipart support will only be enabled on requests made through the <code>DispatcherServlet</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Spring Boot will automatically rename any <code>MultipartResolver</code> bean to <strong>multipartResolver</strong> so it will be picked up by the <code>DispatcherServlet</code>.
If you want to use the <code>MultipartFilter</code> but want to customize the <code>MultipartResolver</code> it uses, you should ensure that the resolver bean is injected in the AcrossWebModule and not exposed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Disabling multipart configuration</div>
<p>Disabling the automatic multipart resolving configuration can be done by setting <strong>acrossWebModule.multipart.auto-configure</strong> to <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_mode_support"><a class="anchor" href="#_development_mode_support"></a>17. Development mode support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AcrossWebModule supports development mode retrieval of physical resources.
If the conventions for static resources and Thymeleaf templates were followed, these will be fetched automatically from their physical location.
This ensures that an application restart is not required for static resources or Thymeleaf rendering.</p>
</div>
<div class="paragraph">
<p>If development mode is active AcrossWebModule will also send no-cache headers for static resources and will use a generated fixed version if versioning is enabled.</p>
</div>
<div class="paragraph">
<p><code>ViewElement</code> rendering will also <a href="#dev-mode-rendering">output debugging information</a> when development mode is active.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_published_events"><a class="anchor" href="#_published_events"></a>18. Published events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is a listing of possible events published by the AcrossWebModule or one of its components.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Core events</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildMenuEvent&lt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event fired by the <code>MenuFactory</code> whenever a menu is being generated.
Allows configuring the menu using the <code>PathBasedMenuBuilder</code>.
Event discriminator is the menu name or custom menu type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildMenuFinishedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event fired by the <code>MenuFactory</code> whenever a menu has been build, sorted and the corresponding item has been selected.
Can be used to modify the menu after build has completed.
Event discriminator is the menu name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildTemplateWebResourcesEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event published by a <code>LayoutTemplateProcessorAdapterBean</code> after a named template has been prepared.
Allows event handlers to register additional web resources for that template.
Event discriminator is the template name.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="across-test" class="sect0"><a class="anchor" href="#across-test"></a>Testing</h1>
<div class="paragraph">
<p>Testing your shared Across modules or your Across application can be done using Across Test.
Across Test is a utility library extending the Spring testing library.
It provides helpers for integration testing in a standard or web context.</p>
</div>
<div class="paragraph">
<p>Across Test also integrates with the AcrossWebModule features for testing.</p>
</div>
<h2 id="_artifact_3" class="discrete">Artifact</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>com.foreach.across<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>across-test<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_base_test_classes"><a class="anchor" href="#_base_test_classes"></a>1. Base test classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across Test offers some base classes for related unit or integration tests.</p>
</div>
<h3 id="_abstractacrossmoduleconventionstest" class="discrete">AbstractAcrossModuleConventionsTest</h3>
<div class="paragraph">
<p>Across Test comes with a base unit test class that can be used to verify an <code>AcrossModule</code> implementation adheres to the <a href="#module-conventions">conventions</a>.
All you have to do is extend from <code>AbstractAcrossModuleConventionsTest</code> and implement the <code>createModule()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Basic implementation of a module conventions test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TestAcrossWebModuleConventions</span> <span class="directive">extends</span> AbstractAcrossModuleConventionsTest
{
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> AcrossModule createModule() {
                <span class="keyword">return</span> <span class="keyword">new</span> AcrossWebModule();
        }
}</code></pre>
</div>
</div>
<h3 id="_abstractviewelementtemplatetest" class="discrete">AbstractViewElementTemplateTest</h3>
<div class="paragraph">
<p>Base integration test class for testing the rendering of a <code>ViewElement</code>.
Provides useful methods for rendering and inspecting the generated output.</p>
</div>
<div class="listingblock">
<div class="title">Example ViewElement rendering test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TestNodeViewElement</span> <span class="directive">extends</span> AbstractViewElementTemplateTest
{
        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> simpleNodeWithoutContentOrAttributes() {
                NodeViewElement node = <span class="keyword">new</span> NodeViewElement( <span class="string"><span class="delimiter">&quot;</span><span class="content">div</span><span class="delimiter">&quot;</span></span> );

                renderAndExpect( node, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;div&gt;&lt;/div&gt;</span><span class="delimiter">&quot;</span></span> );
        }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-builders"><a class="anchor" href="#test-builders"></a>2. Test context builders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across Test comes with a set of helpers for integration testing an Across module with all its dependencies.
Main access point is the <code>AcrossTestBuilders</code> class that will provide you with either an <code>AcrossTestContextBuilder</code> or <code>AcrossTestWebContextBuilder</code>.
The latter should be used if you want to simulate a web container environment.</p>
</div>
<div class="paragraph">
<p>Both builder implementations provide a fluent api for easily configuring an <code>AcrossContext</code> and setting application properties.
See the javadoc for all different configuration options.
Upon building the <code>AcrossContext</code> will be bootstrapped and an instance of <code>AcrossTestContext</code> will be returned.
<code>AcrossTestContext</code> (and the extending <code>AcrossTestWebContext</code>) wraps around the bootstrapped <code>AcrossContext</code> and provides easy querying of the bootstrapped context.
In addition <code>AcrossTestContext</code> implements <code>Closeable</code> that shuts down the context, easy for using with try-with-resources.</p>
</div>
<div class="listingblock">
<div class="title">Simple text context builder example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
   <span class="directive">public</span> <span class="type">void</span> verifySomeBeanIsExposed() {
       <span class="keyword">try</span> (
               AcrossTestContext ctx = AcrossTestBuilders.standard()
                       .modules( SomeModule.NAME )
                       .build()
       ) {
           <span class="comment">// SomeBean should be available in the root context</span>
           assertNotNull( ctx.getBeanOfType( SomeBean.class ) );
       }
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the builders will by default load the <a href="#test-datasources">test datasources</a> and will execute a reset of the databases before bootstrapping.
Both options can be configured separately on the builder.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You should obviously make sure you are not dropping the databases when connecting to an existing database.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example connecting to existing datasource</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
   <span class="directive">public</span> <span class="type">void</span> doSomethingOnExisting() {
       <span class="keyword">try</span> (
               AcrossTestContext ignore = AcrossTestBuilders.standard()
                       .useTestDataSource( <span class="predefined-constant">false</span> )
                       .dropFirst( <span class="predefined-constant">false</span> )
                       .dataSource( ds )
                       .build()
       ) {
           ...
       }
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a web scenario the <code>AcrossTestWebContextBuilder</code> should be used.
This will ensure a <code><a href="#mock-across-servlet-context">MockAcrossServletContext</a></code> is being used and return an <code>AcrossTestWebContext</code>.
The <code>AcrossTestWebContext</code> provides access to the <code>MockAcrossServletContext</code> and a <code>MockMvc</code> bean that is instantiated with all filters registered by the modules.</p>
</div>
<div class="listingblock">
<div class="title">Example web context builder with mock mvc call</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
   <span class="directive">public</span> <span class="type">void</span> filterNotRegisteredButResourceStillWorks() {
       <span class="keyword">try</span> (
               AcrossTestWebContext ctx = AcrossTestBuilders.web()
                       .property( <span class="string"><span class="delimiter">&quot;</span><span class="content">acrossWebModule.resources.versioning.enabled</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> )
                       .modules( AcrossWebModule.NAME )
                       .build()
       ) {
           <span class="comment">// URL encoding filter should not be registered</span>
           MockAcrossServletContext servletContext = ctx.getServletContext();
           assertNull( servletContext.getFilterRegistration( ResourceUrlEncodingFilterConfiguration.FILTER_NAME ) );

           <span class="comment">// Static resource should still be returned</span>
           MockMvc mvc = ctx.mockMvc();
           mvc.perform( get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/across/resources/static/testResources/test.txt</span><span class="delimiter">&quot;</span></span> ) )
               .andExpect( status().isOk() )
       }
   }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-annotations"><a class="anchor" href="#test-annotations"></a>3. Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Across Test library also provides a set of Across-specific annotations that extend the default Spring Testing annotations (eg <code>@ContextConfiguration</code>) to support <code>AcrossContext</code> setups.</p>
</div>
<div class="sect2">
<h3 id="annotation-across-test-configuration"><a class="anchor" href="#annotation-across-test-configuration"></a>3.1. @AcrossTestConfiguration</h3>
<div class="paragraph">
<p>Class-level annotation to be used as an alternative to <code><a href="#enableacrosscontext">@EnableAcrossContext</a></code>.
Like <code>@EnableAcrossContext</code> this annotation will configure and bootstrap an <code>AcrossContext</code> but also add support for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test-datasources">test datasources</a></p>
</li>
<li>
<p>resetting the database before bootstrap</p>
</li>
<li>
<p>creating a <code>MockMvc</code> bean instantiated with all dynamically registered filters from the context, when used in a <code><a href="#acrosswebappconfiguration">@AcrossWebAppConfiguration</a></code> test class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using either <code>@EnableAcrossContext</code> or <code>@AcrossTestConfiguration</code>, all beans exposed can be wired directly in the unit test class.</p>
</div>
<div class="listingblock">
<div class="title">Example using @AcrossTestConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@DirtiesContext</span>
<span class="annotation">@ContextConfiguration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestSample</span>
{
        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> MyExposedBean myExposedBean;

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> doSomethingWithMyExposedBean() {
                ...
        }

        <span class="annotation">@AcrossTestConfiguration</span>(modules = { MyModule.NAME })
        <span class="directive">protected</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span>
        {
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acrosswebappconfiguration"><a class="anchor" href="#acrosswebappconfiguration"></a>3.2. @AcrossWebAppConfiguration</h3>
<div class="paragraph">
<p>Class-level annotation that sets up a <code>@WebAppConfiguration</code> test that uses a <code><a href="#mock-across-servlet-context">MockAcrossServletContext</a></code> for initialization.
<code>@AcrossWebAppConfiguration</code> contains a <code>@ContextConfiguration</code> annotation, unless additional annotations are specified, it will load static innter <code>@Configuration</code> classes of the annotated test class.</p>
</div>
<div class="paragraph">
<p>When using this annotation on a test class the <code>MockAcrossServletContext</code> instance can be autowired for introspection.
In combination with an inner static <code>@AcrossTestConfiguration</code> class, this will support a <code>MockMvc</code> instance initialized with all dynamically registered filters.</p>
</div>
<div class="listingblock">
<div class="title">Example combining @AcrossWebAppConfiguration and @AcrossTestConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@DirtiesContext</span>
<span class="annotation">@AcrossWebAppConfiguration</span>
<span class="annotation">@TestPropertySource</span>( properties = <span class="string"><span class="delimiter">&quot;</span><span class="content">acrossWebModule.resources.versioning.enabled=false</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestSample</span>
{
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MockAcrossServletContext servletContext;

        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> MockMvc mvc;

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> resourceUrlEncodingFilterShouldNotBeRegistered() {
        assertNull( servletContext.getFilterRegistration( ResourceUrlEncodingFilterConfiguration.FILTER_NAME ) );
        }

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> staticResourceShouldBeReturned() {
            mvc.perform( get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/across/resources/static/testResources/test.txt</span><span class="delimiter">&quot;</span></span> ) )
           .andExpect( status().isOk() )
        }

        <span class="annotation">@AcrossTestConfiguration</span>(modules = { AcrossWebModule.NAME })
        <span class="directive">protected</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span>
        {
        }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mock_mvc_integration"><a class="anchor" href="#_mock_mvc_integration"></a>4. Mock MVC integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default using either the <a href="#test-builders">test builders</a> or <a href="#annotation-across-test-configuration">@AcrossTestConfiguration</a> will provide you with a singleton <code>MockMvc</code> instance that is configured with the bootstrapped <code>AcrossContext</code>.
You can also manually add this singleton configuration by importing the <code>MockMvcConfiguration</code> in your test application context, see the example in the <a href="#boot-integration-test-mockmvc">Spring Boot section</a>.</p>
</div>
<div class="paragraph">
<p>Across Test also provides a <code>AcrossMockMvcBuilders</code> class that has factory methods for creating an ad hoc <code>MockMvcBuilder</code> based on a bootstrapped <code>AcrossContext</code>.
Use this implementation if you want to customize the <code>MockMvc</code> configuration, for example for Spring REST documentation generation.</p>
</div>
<div class="listingblock">
<div class="title">Ad hoc instantiation of a MockMvc instance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@DirtiesContext</span>
<span class="annotation">@AcrossWebAppConfiguration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestSample</span>
{
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> AcrossContextInfo contextInfo;

    <span class="directive">private</span> MockMvc mvc;

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() {
        <span class="local-variable">this</span>.mvc = AcrossMockMvcBuilders.acrossContextSetup( contextInfo ).build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> staticResourceShouldBeReturned() {
        mvc.perform( get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/across/resources/static/testResources/test.txt</span><span class="delimiter">&quot;</span></span> ) )
           .andExpect( status().isOk() )
    }

    <span class="annotation">@EnableAcrossContext</span>(modules = { AcrossWebModule.NAME })
    <span class="directive">protected</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span>
    {
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mock-across-servlet-context"><a class="anchor" href="#mock-across-servlet-context"></a>5. MockAcrossServletContext</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>MockAcrossServletContext</code> is an extension of the <code>MockServletContext</code> from Spring Test.
It adds an implementation that keeps track of all registered servlets, filters and listeners.</p>
</div>
<div class="paragraph">
<p>Unlike the <code>MockServletContext</code> this implementation does not throw an <code>UnsupportedOperationException</code> on registration operations.
For common operations like servlet and filter registration this implementation will behave as an actual <code>ServletContext</code> from a web container.
The actual registrations that occurred can be retrieved - in order - from the <code>MockAcrossServletContext</code>.</p>
</div>
<div class="paragraph">
<p><code>MockAcrossServletContext</code> can also mimic initialization of the <code>ServletContext</code>.
When <code>initialize()</code> is called, the <code>init()</code> methods of the servlet/filter instances will be called with the registration parameters.
Note that <code>initialize()</code> can be called only once, and afterwards all registration operations will throw an <code>IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>Using a <code>MockAcrossServletContext</code> can be used for unit testing <code>AcrossWebDynamicServletConfigurer</code> implementations or for integration tests needing web functionality.
<code>MockAcrossServletContext</code> is used automatically behind the scenes when using the <a href="#test-builders">test builders</a> or <a href="#test-annotations">annotations</a>.
In an integration test scenario, the implementation can either be wired as a bean (when using the <a href="#test-annotations">annotations</a>) or retrieved from the resulting <code>AcrossTestWebContext</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the javadoc for <code>MockAcrossServletContext</code> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_across_application_testing"><a class="anchor" href="#_across_application_testing"></a>6. Across application testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to test your <code>@AcrossApplication</code> with Spring Boot testing support.
Using the <code>@SpringBootTest</code> in your tests is necessary for default <em>application.properties</em> loading and YAML support.
Refer to the Spring Boot reference documentation for more information on Spring Boot testing facilities.</p>
</div>
<div class="sect2">
<h3 id="__webintegrationtest"><a class="anchor" href="#__webintegrationtest"></a>6.1. @WebIntegrationTest</h3>
<div class="paragraph">
<p>A full-stack web integration test (eg. with an embedded Tomcat) does not require any special configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example integration test with an embedded servlet container on a random port</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@WebIntegrationTest</span>(randomPort = <span class="predefined-constant">true</span>)
<span class="annotation">@SpringBootTest</span>(classes = MyApplication.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestSpringBootWebIntegration</span>
{
        <span class="directive">private</span> <span class="directive">final</span> TestRestTemplate restTemplate = <span class="keyword">new</span> TestRestTemplate();

        <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${local.server.port}</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">private</span> <span class="type">int</span> port;

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> controllersShouldSayHello() {
                assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">application says hello</span><span class="delimiter">&quot;</span></span>, get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/application</span><span class="delimiter">&quot;</span></span> ) );
                assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">infrastructure says hello</span><span class="delimiter">&quot;</span></span>, get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/infrastructure</span><span class="delimiter">&quot;</span></span> ) );
        }

        <span class="directive">private</span> <span class="predefined-type">String</span> get( <span class="predefined-type">String</span> relativePath ) {
                <span class="keyword">return</span> restTemplate.getForEntity( url( relativePath ), <span class="predefined-type">String</span>.class ).getBody();
        }

        <span class="directive">private</span> <span class="predefined-type">String</span> url( <span class="predefined-type">String</span> relativePath ) {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="delimiter">&quot;</span></span> + port + relativePath;
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="boot-integration-test-mockmvc"><a class="anchor" href="#boot-integration-test-mockmvc"></a>6.2. Integration test with MockMvc support</h3>
<div class="paragraph">
<p>It is also possible to start your entire <code>@AcrossApplication</code> without an embedded servlet container.
However if you want to have support for <code>MockMvc</code> instantiated with dynamically registered filters, you must manually configure the application loader to use a <code><a href="#mock-across-servlet-context">MockAcrossServletContext</a></code>.
This is done by adding the required configuration to <code>@SpringBootTest</code> and initializer classes to the <code>@ContextConfiguration</code>.
See the <a href="#appendix-test-configuration-classes">appendix section</a> for an overview of all configuration classes available.</p>
</div>
<div class="listingblock">
<div class="title">Example Spring Boot integration test with MockMvc</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@WebAppConfiguration</span>
<span class="annotation">@SpringBootTest</span>( classes = { MyApplication.class, MockMvcConfiguration.class } )
<span class="annotation">@ContextConfiguration</span>( initializers = MockAcrossServletContextInitializer.class )
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestSpringBootMockMvc</span>
{
        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> MockMvc mockMvc;

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> controllersShouldSayHello() <span class="directive">throws</span> <span class="exception">Exception</span> {
                assertContent( <span class="string"><span class="delimiter">&quot;</span><span class="content">application says hello</span><span class="delimiter">&quot;</span></span>, get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/application</span><span class="delimiter">&quot;</span></span> ) );
                assertContent( <span class="string"><span class="delimiter">&quot;</span><span class="content">infrastructure says hello</span><span class="delimiter">&quot;</span></span>, get( <span class="string"><span class="delimiter">&quot;</span><span class="content">/infrastructure</span><span class="delimiter">&quot;</span></span> ) );
        }

        <span class="directive">private</span> <span class="type">void</span> assertContent( <span class="predefined-type">String</span> expected, RequestBuilder requestBuilder ) <span class="directive">throws</span> <span class="exception">Exception</span> {
                mockMvc.perform( requestBuilder )
                       .andExpect( status().isOk() )
                       .andExpect( content().string( is( expected ) ) );
        }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using <code>@AcrossWebAppConfiguration</code> in combination with <code>@SpringBootTest</code> is not possible, as the context loaders they use conflict with each other.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_dynamic_modules"><a class="anchor" href="#_testing_dynamic_modules"></a>7. Testing dynamic modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testing dynamic modules outside of a full <code>@AcrossApplication</code> test can be done by adding one or more <code>AcrossDynamicModulesConfigurer</code> instances to the <code>AcrossContext</code> configuration.
Every configurer instance is responsible for building a set of dynamic modules for a particular base package.
An existing <code>@AcrossApplication</code> class can easily be reused as base for the configurer.</p>
</div>
<div class="listingblock">
<div class="title">Example adding dynamic modules to a builder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> dynamicModulesRegistration() {
    <span class="keyword">try</span> (
            AcrossTestContext ctx = standard()
                    .configurer( <span class="keyword">new</span> AcrossDynamicModulesConfigurer( DummyApplication.class ) )
                    .build()
    ) {
        assertTrue( ctx.contextInfo().hasModule( <span class="string"><span class="delimiter">&quot;</span><span class="content">DummyApplicationModule</span><span class="delimiter">&quot;</span></span> ) );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example adding dynamic modules to an annotations based test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@DirtiesContext</span>
<span class="annotation">@ContextConfiguration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestDynamicModulesConfiguration</span>
{
        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> AcrossContextInfo contextInfo;

        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> sampleModulesShouldBeAdded() {
            assertTrue( contextInfo.hasModule( <span class="string"><span class="delimiter">&quot;</span><span class="content">DummyApplicationModule</span><span class="delimiter">&quot;</span></span> ) );
           }

        <span class="annotation">@Configuration</span>
        <span class="annotation">@EnableAcrossContext</span>
        <span class="directive">protected</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SampleConfiguration</span>
        {
                <span class="annotation">@Bean</span>
                <span class="directive">public</span> AcrossDynamicModulesConfigurer sampleDynamicModules() {
                        <span class="keyword">return</span> <span class="keyword">new</span> AcrossDynamicModulesConfigurer( DummyApplication.class );
                }
        }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-datasources"><a class="anchor" href="#test-datasources"></a>8. Test datasources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using the Across Test <a href="#test-annotations">annotations</a> or <a href="#test-builders">builders</a>, default support for test datasources is activated.
If no specific datasource is configured on the <code>AcrossContext</code> a default test datasource will be detected.</p>
</div>
<div class="paragraph">
<div class="title">Test datasource detection</div>
<p>Test datasources can be configured in a specific property file, located at <strong>${user.home}/dev-configs/across-test.properties</strong>.
That file is automatically loaded and can contain multiple datasource sections, where every datasource has a unique <strong>NAME</strong> and its properties are prefixed with <strong>acrossTest.datasource.NAME</strong>.
Required properties for a valid datasource are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>acrossTest.datasource.NAME.driver</p>
</li>
<li>
<p>acrossTest.datasource.NAME.url</p>
</li>
<li>
<p>acrossTest.datasource.NAME.username</p>
</li>
<li>
<p>acrossTest.datasource.NAME.password</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example across-test.properties file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">acrossTest.datasource.mysql.driver=com.mysql.jdbc.Driver
acrossTest.datasource.mysql.url=jdbc:mysql://127.0.0.1:3306/testdb
acrossTest.datasource.mysql.username=testdb_user
acrossTest.datasource.mysql.password=testdb_pwd</code></pre>
</div>
</div>
<div class="paragraph">
<p>When configuring the context, the environment property <strong>acrossTest.datasource</strong> will be checked to determine the <strong>NAME</strong> of the actual datasource that shoul be used.
If that property does not exist or holds the value <strong>auto</strong>, an embedded HSQLDB is automatically added instead.
This ensures that installers can always run against an actual datasource.</p>
</div>
<div class="paragraph">
<p>If you want to change the fallback default datasource, you can do so by setting the <strong>acossTest.datasource.default</strong> property value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A common strategy is to run the integration tests multiple times with a different <strong>acrossTest.datasource</strong> property.
The <strong>standard-module-bom</strong> automatically configures your maven build to run all unit test starting with <strong>IT</strong>* in the integration-test phase.
This is an efficient way to test for example installer compatibility for different database types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to manually add support for test datasources, you should add a <code>TestDataSourceConfigurer</code> for configuring the <code>AcrossContext</code>.</p>
</div>
<div class="paragraph">
<div class="title">Database reset</div>
<p>When using test datasources it is usually wanted behaviour to drop the database content before bootstrapping the <code>AcrossContext</code>.
This is done automatically when you are using the Across Test annotations or builders.
If you want to add this manually, you should add a <code>ResetDatabaseConfigurer</code> to the context configuration.</p>
</div>
</div>
</div>
<h1 id="_appendices" class="sect0"><a class="anchor" href="#_appendices"></a>Appendices</h1>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>1. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_module_not_found"><a class="anchor" href="#_module_not_found"></a>1.1. Module not found</h3>
<div class="paragraph">
<p>By default modules are resolved using a <code>ClassPathScanningModuleDependencyResolver</code>.
If a module can&#8217;t be resolved the reason is usually one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the package containing the module has not been added for module scanning</p>
</li>
<li>
<p>there is no <code>public static final String NAME</code> field containing the unique module name</p>
</li>
<li>
<p>there is no public constructor without parameters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure more verbose logging by setting the logger level for <code>com.foreach.across.core.context.ClassPathScanningCandidateModuleProvider</code> to <code>TRACE</code>.
This will output all candidate modules that have been considered during scanning.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_across_core_events"><a class="anchor" href="#_across_core_events"></a>2. Across core events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is a listing of all events published by Across core when starting the application.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Core events</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossModuleBeforeBootstrapEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event that is sent right before the module is bootstrapped.
The configuration of the module can still be modified at this point.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossModuleBootstrappedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event published when a module has bootstrapped.
That means the module itself has started, but installers attached to the <code>AfterModuleBootstrap</code> phase have not yet been executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossContextBootstrappedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event published after the AcrossContext has bootstrapped.
That means full initialization has happened: all modules are started and all installers have been executed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_across_core_components"><a class="anchor" href="#_across_core_components"></a>3. Across core components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is a listing of the default components (beans) that are created by the Across context.
These beans are always available and accessible in every module.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Core components</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossContextInfo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root context information of the Across context.
Gives access to the actual modules started in the context and their underlying configuration or <code>ApplicationContext</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossContextBeanRegistry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Central registry allowing you to query to the entire <code>ApplicationContext</code> hierarchy that makes up the Across context.
Allows retrieval of module internal components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossInstallerRepository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The repository for accessing tracked installer information or manually manipulating the installer records.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConversionService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default <code>ConversionService</code> used by Across.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DistributedLockRepository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A service component for creating locks that use the underlying RDBMS for synchronization.
This is a simple locking mechanism that can be used for distributed locks in a multi server deploy.
The lock repository is also used by the installer tracking mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossDevelopmentMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utility bean that can be used to verify if <a href="#development-mode">development mode</a> is active, and to get development locations for resources files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MessageSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default Across <code>MessageSource</code> bean that represents the module based message source hierarchy.
See the chapter on <a href="#message-source">Message sources</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exposes the <code>AcrossCompositeCacheManager</code>.
A default <code>CacheManager</code> implementation where additional <code>CacheManager</code> instances can be registered.
A <code>Cache</code> instance will always be returned, defaulting to a <code>NoOpCache</code> if no actual managers have been added.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="appendix-test-configuration-classes"><a class="anchor" href="#appendix-test-configuration-classes"></a>4. Test configuration classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Across Test library has a number of <code>@Configuration</code> and <code>AcrossContextConfigurer</code> classes that can come in useful when setting up integration tests.
These configurations can be found in the <code>com.foreach.across.test.support.config</code> package.</p>
</div>
<div class="paragraph">
<p>Making use of these directly is only required when setting up integration tests without the Across <a href="#test-annotations">test annotations</a> or <a href="#test-builders">builders</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Test configuration classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TestDataSourceConfigurer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossContextConfigurer</code> that will configure the <a href="#test-datasources">test datasource</a> on the <code>AcrossContext</code> if no other datasource has been set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResetDatabaseConfigurer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AcrossContextConfigurer</code> that resets the datasources attached to the <code>AcrossContext</code> before it bootstraps.
This will drop all tables, stored procedures etc in the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MockMvcConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a <code>MockMvc</code> bean that will be created from a bootstrapped <code>AcrossContext</code>.
If a <code>MockAcrossServletContext</code> is available, all registered filters will be configured on the <code>MockMvc</code> instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MockAcrossServletContextInitializer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationContextInitializer</code> for use with <code>@ContextConfiguration</code> that ensures that <code>MockAcrossServletContext</code> is used instead of the default <code>MockServletContext</code>.
Note that this initializer also requires that <code>@WebAppConfiguration</code> has been used on the test class.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-11-14 21:10:43 CET
</div>
</div>
</body>
</html>